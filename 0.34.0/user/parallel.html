<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>1.9. Automatic parallelization with @jit &mdash; Numba 0.34.0-py2.7-macosx-10.6-x86_64.egg documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../',
            VERSION:     '0.34.0-py2.7-macosx-10.6-x86_64.egg',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Numba 0.34.0-py2.7-macosx-10.6-x86_64.egg documentation" href="../index.html" />
    <link rel="up" title="1. User Manual" href="index.html" />
    <link rel="next" title="1.10. Troubleshooting and tips" href="troubleshoot.html" />
    <link rel="prev" title="1.8. Compiling code ahead of time" href="pycc.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Numba 0.34.0-py2.7-macosx-10.6-x86_64.egg documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">1.9. Automatic parallelization with <code class="docutils literal"><span class="pre">&#64;jit</span></code></a><ul>
<li><a class="reference internal" href="#supported-operations">1.9.1. Supported Operations</a></li>
<li><a class="reference internal" href="#explicit-parallel-loops">1.9.2. Explicit Parallel Loops</a></li>
<li><a class="reference internal" href="#examples">1.9.3. Examples</a></li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="pycc.html" title="1.8. Compiling code ahead of time" accesskey="P">previous </a></li>
              <li><a href="troubleshoot.html" title="1.10. Troubleshooting and tips" accesskey="N">next </a></li>
              <li><a href="../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="index.html" accesskey="U">1. User Manual</a></li>
            
            <li class="visible-xs"><a href="../_sources/user/parallel.rst.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.9. Automatic parallelization with <code class="docutils literal"><span class="pre">&#64;jit</span></code></a><ul>
<li><a class="reference internal" href="#supported-operations">1.9.1. Supported Operations</a></li>
<li><a class="reference internal" href="#explicit-parallel-loops">1.9.2. Explicit Parallel Loops</a></li>
<li><a class="reference internal" href="#examples">1.9.3. Examples</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pycc.html"
                        title="previous chapter">1.8. Compiling code ahead of time</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="troubleshoot.html"
                        title="next chapter">1.10. Troubleshooting and tips</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/parallel.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="automatic-parallelization-with-jit">
<span id="numba-parallel"></span><h1>1.9. Automatic parallelization with <code class="docutils literal"><span class="pre">&#64;jit</span></code><a class="headerlink" href="#automatic-parallelization-with-jit" title="Permalink to this headline">¶</a></h1>
<p>Setting the <a class="reference internal" href="jit.html#parallel-jit-option"><span class="std std-ref">parallel</span></a> option for <a class="reference internal" href="../reference/jit-compilation.html#numba.jit" title="numba.jit"><code class="xref py py-func docutils literal"><span class="pre">jit()</span></code></a> enables
an experimental Numba feature that attempts to automatically parallelize and
perform other optimizations on (part) of a function. At the moment, this
feature only works on CPUs.</p>
<p>Some operations inside a user defined function, e.g., adding a scalar value to
an array, are known to have parallel semantics.  A user program may contain
many such operations and while each operation could be parallelized
individually, such an approach often has lackluster performance due to poor
cache behavior.  Instead, with auto-parallelization, Numba attempts to
identify such operations in a user program, and fuse adjacent ones together,
to form one or more kernels that are automatically run in parallel.
The process is fully automated without modifications to the user program,
which is in contrast to Numba&#8217;s <a class="reference internal" href="../reference/jit-compilation.html#numba.vectorize" title="numba.vectorize"><code class="xref py py-func docutils literal"><span class="pre">vectorize()</span></code></a> or
<a class="reference internal" href="../reference/jit-compilation.html#numba.guvectorize" title="numba.guvectorize"><code class="xref py py-func docutils literal"><span class="pre">guvectorize()</span></code></a> mechanism, where manual effort is required
to create parallel kernels.</p>
<div class="section" id="supported-operations">
<h2>1.9.1. Supported Operations<a class="headerlink" href="#supported-operations" title="Permalink to this headline">¶</a></h2>
<p>In this section, we give a list of all the array operations that have
parallel semantics and for which we attempt to parallelize.</p>
<ol class="arabic">
<li><p class="first">All numba array operations that are supported by <a class="reference internal" href="../developer/rewrites.html#case-study-array-expressions"><span class="std std-ref">Case study: Array Expressions</span></a>,
which include common arithmetic functions between Numpy arrays, and between
arrays and scalars, as well as Numpy ufuncs. They are often called
<cite>element-wise</cite> or <cite>point-wise</cite> array operations:</p>
<blockquote>
<div><ul class="simple">
<li>unary operators: <code class="docutils literal"><span class="pre">+</span></code> <code class="docutils literal"><span class="pre">-</span></code> <code class="docutils literal"><span class="pre">~</span></code></li>
<li>binary operators: <code class="docutils literal"><span class="pre">+</span></code> <code class="docutils literal"><span class="pre">-</span></code> <code class="docutils literal"><span class="pre">*</span></code> <code class="docutils literal"><span class="pre">/</span></code> <code class="docutils literal"><span class="pre">/?</span></code> <code class="docutils literal"><span class="pre">%</span></code> <code class="docutils literal"><span class="pre">|</span></code> <code class="docutils literal"><span class="pre">&gt;&gt;</span></code> <code class="docutils literal"><span class="pre">^</span></code> <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> <code class="docutils literal"><span class="pre">&amp;</span></code> <code class="docutils literal"><span class="pre">**</span></code> <code class="docutils literal"><span class="pre">//</span></code></li>
<li>comparison operators: <code class="docutils literal"><span class="pre">==</span></code> <code class="docutils literal"><span class="pre">!=</span></code> <code class="docutils literal"><span class="pre">&lt;</span></code> <code class="docutils literal"><span class="pre">&lt;=</span></code> <code class="docutils literal"><span class="pre">&gt;</span></code> <code class="docutils literal"><span class="pre">&gt;=</span></code></li>
<li><a class="reference internal" href="../reference/numpysupported.html#supported-ufuncs"><span class="std std-ref">Numpy ufuncs</span></a> that are supported in <a class="reference internal" href="../glossary.html#term-nopython-mode"><span class="xref std std-term">nopython mode</span></a>.</li>
<li>User defined <a class="reference internal" href="../reference/jit-compilation.html#numba.DUFunc" title="numba.DUFunc"><code class="xref py py-class docutils literal"><span class="pre">DUFunc</span></code></a> through <a class="reference internal" href="../reference/jit-compilation.html#numba.vectorize" title="numba.vectorize"><code class="xref py py-func docutils literal"><span class="pre">vectorize()</span></code></a>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Numpy reduction functions <code class="docutils literal"><span class="pre">sum</span></code> and <code class="docutils literal"><span class="pre">prod</span></code>. Note that they have to be
written as <code class="docutils literal"><span class="pre">numpy.sum(a)</span></code> instead of <code class="docutils literal"><span class="pre">a.sum()</span></code>.</p>
</li>
<li><p class="first">Numpy array creation functions <code class="docutils literal"><span class="pre">zeros</span></code>, <code class="docutils literal"><span class="pre">ones</span></code>, and <code class="docutils literal"><span class="pre">random.ranf</span></code>.</p>
</li>
<li><p class="first">Numpy <code class="docutils literal"><span class="pre">dot</span></code> function between a matrix and a vector, or two vectors.
In all other cases, Numba&#8217;s default implementation is used.</p>
</li>
<li><p class="first">Multi-dimensional arrays are also supported for the above operations
when operands have matching dimension and size. The full semantics of
Numpy broadcast between arrays with mixed dimensionality or size is
not supported, nor is the reduction across a selected dimension.</p>
</li>
</ol>
</div>
<div class="section" id="explicit-parallel-loops">
<h2>1.9.2. Explicit Parallel Loops<a class="headerlink" href="#explicit-parallel-loops" title="Permalink to this headline">¶</a></h2>
<p>Another experimental feature of this module is support for explicit parallel
loops. One can use Numba&#8217;s <code class="docutils literal"><span class="pre">prange</span></code> instead of <code class="docutils literal"><span class="pre">range</span></code> to specify that a
loop can be parallelized. The user is required to make sure that the loop does
not have cross iteration dependencies except the supported reductions.
Currently, reductions on scalar values are supported and are inferred from
in-place operations. The example below demonstrates a parallel loop with a
reduction (<code class="docutils literal"><span class="pre">A</span></code> is a one-dimensional Numpy array):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numba</span> <span class="k">import</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span>
<span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">prange_test</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h2>1.9.3. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>In this section, we give an example of how this feature helps
parallelize Logistic Regression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logistic_regression</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(((</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">w</span><span class="p">)))</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Y</span><span class="p">),</span> <span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w</span>
</pre></div>
</div>
<p>We will not discuss details of the algorithm, but instead focus on how
this program behaves with auto-parallelization:</p>
<ol class="arabic simple">
<li>Input <code class="docutils literal"><span class="pre">Y</span></code> is a vector of size <code class="docutils literal"><span class="pre">N</span></code>, <code class="docutils literal"><span class="pre">X</span></code> is an <code class="docutils literal"><span class="pre">N</span> <span class="pre">x</span> <span class="pre">D</span></code> matrix,
and <code class="docutils literal"><span class="pre">w</span></code> is a vector of size <code class="docutils literal"><span class="pre">D</span></code>.</li>
<li>The function body is an iterative loop that updates variable <code class="docutils literal"><span class="pre">w</span></code>.
The loop body consists of a sequence of vector and matrix operations.</li>
<li>The inner <code class="docutils literal"><span class="pre">dot</span></code> operation produces a vector of size <code class="docutils literal"><span class="pre">N</span></code>, followed by a
sequence of arithmetic operations either between a scalar and vector of
size <code class="docutils literal"><span class="pre">N</span></code>, or two vectors both of size <code class="docutils literal"><span class="pre">N</span></code>.</li>
<li>The outer <code class="docutils literal"><span class="pre">dot</span></code> produces a vector of size <code class="docutils literal"><span class="pre">D</span></code>, followed by an inplace
array subtraction on variable <code class="docutils literal"><span class="pre">w</span></code>.</li>
<li>With auto-parallelization, all operations that produce array of size
<code class="docutils literal"><span class="pre">N</span></code> are fused together to become a single parallel kernel. This includes
the inner <code class="docutils literal"><span class="pre">dot</span></code> operation and all point-wise array operations following it.</li>
<li>The outer <code class="docutils literal"><span class="pre">dot</span></code> operation produces a result array of different dimension,
and is not fused with the above kernel.</li>
</ol>
<p>Here, the only thing required to take advantage of parallel hardware is to set
the <a class="reference internal" href="jit.html#parallel-jit-option"><span class="std std-ref">parallel</span></a> option for <a class="reference internal" href="../reference/jit-compilation.html#numba.jit" title="numba.jit"><code class="xref py py-func docutils literal"><span class="pre">jit()</span></code></a>, with no
modifications to the <code class="docutils literal"><span class="pre">logistic_regression</span></code> function itself.  If we were to
give an equivalence parallel implementation using <a class="reference internal" href="../reference/jit-compilation.html#numba.guvectorize" title="numba.guvectorize"><code class="xref py py-func docutils literal"><span class="pre">guvectorize()</span></code></a>,
it would require a pervasive change that rewrites the code to extract kernel
computation that can be parallelized, which was both tedious and challenging.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="jit.html#parallel-jit-option"><span class="std std-ref">parallel</span></a></p>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../index.html">Numba 0.34.0-py2.7-macosx-10.6-x86_64.egg documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="pycc.html" title="1.8. Compiling code ahead of time" >previous</a></li>
        <li><a href="troubleshoot.html" title="1.10. Troubleshooting and tips" >next</a></li>
        <li><a href="../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../genindex.html" title="General Index" >index</a></li>
        <li><a href="index.html" >1. User Manual</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2012-2015, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>