<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.14. Notes on Caching &#8212; Numba 0.46.0.dev0+199.g60d2bdd-py2.7-linux-x86_64.egg documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/numba-docs.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.15. Numba Project Roadmap" href="roadmap.html" />
    <link rel="prev" title="7.13. Notes on Hashing" href="hashing.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/numba_blue_icon_rgb.png"></span>
          Numba</a>
        <span class="navbar-text navbar-version pull-left"><b>0.46</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">1. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">2. Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/index.html">3. Numba for CUDA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roc/index.html">5. Numba for AMD ROC GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">7.14. Notes on Caching</a><ul>
<li><a class="reference internal" href="#the-implementation">7.14.1. The Implementation</a><ul>
<li><a class="reference internal" href="#requirements-for-cacheability">7.14.1.1. Requirements for Cacheability</a></li>
<li><a class="reference internal" href="#features-compatible-with-caching">7.14.1.2. Features Compatible with Caching</a></li>
<li><a class="reference internal" href="#caching-limitations">7.14.1.3. Caching Limitations</a></li>
<li><a class="reference internal" href="#cache-sharing">7.14.1.4. Cache Sharing</a></li>
<li><a class="reference internal" href="#cache-clearing">7.14.1.5. Cache Clearing</a></li>
<li><a class="reference internal" href="#related-environment-variables">7.14.1.6. Related Environment Variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="hashing.html" title="Previous Chapter: 7.13. Notes on Hashing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 7.13. Notes on H...</span>
    </a>
  </li>
  <li>
    <a href="roadmap.html" title="Next Chapter: 7.15. Numba Project Roadmap"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">7.15. Numba Proj... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/developer/caching.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="notes-on-caching">
<span id="developer-caching"></span><h1>7.14. Notes on Caching<a class="headerlink" href="#notes-on-caching" title="Permalink to this headline">¶</a></h1>
<p>Numba supports caching of compiled functions into the filesystem for future
use of the same functions.</p>
<div class="section" id="the-implementation">
<h2>7.14.1. The Implementation<a class="headerlink" href="#the-implementation" title="Permalink to this headline">¶</a></h2>
<p>Caching is done by saving the compiled <em>object code</em>, the ELF object of the
executable code.  By using the <em>object code</em>, cached functions have minimal
overhead because no compilation is needed. The cached data is saved under the
cache directory (see <span class="target" id="index-0"></span><a class="reference internal" href="../reference/envvars.html#envvar-NUMBA_CACHE_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">NUMBA_CACHE_DIR</span></code></a>). The index of the cache is
stored in a <code class="docutils literal notranslate"><span class="pre">.nbi</span></code> file, with one index per function, and it lists all the
overloaded signatures compiled for the function. The <em>object code</em> is stored in
files with an <code class="docutils literal notranslate"><span class="pre">.nbc</span></code> extension, one file per overload.</p>
<div class="section" id="requirements-for-cacheability">
<h3>7.14.1.1. Requirements for Cacheability<a class="headerlink" href="#requirements-for-cacheability" title="Permalink to this headline">¶</a></h3>
<p>Developers should note the requirements of a function to permit it to be cached
to ensure that the features they are working on are compatible with caching.</p>
<p>Requirements for cacheable function:</p>
<ul class="simple">
<li>The LLVM module must be <em>self-contained</em>, meaning that it cannot rely on
other compiled units without linking to them.</li>
<li>The only allowed external symbols are from the
<a class="reference internal" href="numba-runtime.html#arch-numba-runtime"><span class="std std-ref">NRT</span></a> or other common symbols from system libraries
(i.e. libc and libm).</li>
</ul>
<p>Debugging note:</p>
<ul class="simple">
<li>Look for the usage of <code class="docutils literal notranslate"><span class="pre">inttoptr</span></code> in the LLVM IR or
<code class="docutils literal notranslate"><span class="pre">target_context.add_dynamic_add()</span></code> in the lowering code in Python.
They indicate potential usage of runtime address. Not all uses are
problematic and some are necessary. Only the conversion of constant integers
into pointers will affect caching.</li>
<li>Misuse of dynamic address or dynamic symbols will likely result in a
segfault.</li>
<li>Linking order matters because unused symbols are dropped after linking.
Linking should start from the leaf nodes of the dependency graph.</li>
</ul>
</div>
<div class="section" id="features-compatible-with-caching">
<h3>7.14.1.2. Features Compatible with Caching<a class="headerlink" href="#features-compatible-with-caching" title="Permalink to this headline">¶</a></h3>
<p>The following features are explicitly verified to work with caching.</p>
<ul class="simple">
<li>ufuncs and gufuncs for the <code class="docutils literal notranslate"><span class="pre">cpu</span></code> and <code class="docutils literal notranslate"><span class="pre">parallel</span></code> target</li>
<li>parallel accelerator features (i.e. <code class="docutils literal notranslate"><span class="pre">parallel=True</span></code>)</li>
</ul>
</div>
<div class="section" id="caching-limitations">
<h3>7.14.1.3. Caching Limitations<a class="headerlink" href="#caching-limitations" title="Permalink to this headline">¶</a></h3>
<p>This is a list of known limitation of the cache:</p>
<ul class="simple">
<li>Cache invalidation fails to recognize changes in symbols defined in a
different file.</li>
<li>Global variables are treated as constants. The cache will remember the value
in the global variable used at compilation. On cache load, the cached
function will not rebind to the new value of the global variable.</li>
</ul>
</div>
<div class="section" id="cache-sharing">
<span id="id1"></span><h3>7.14.1.4. Cache Sharing<a class="headerlink" href="#cache-sharing" title="Permalink to this headline">¶</a></h3>
<p>It is safe to share and reuse the contents in the cache directory on a
different machine. The cache remembers the CPU model and the available
CPU features during compilation. If the CPU model and the CPU features do
not match exactly, the cache contents will not be considered.
(Also see <span class="target" id="index-1"></span><a class="reference internal" href="../reference/envvars.html#envvar-NUMBA_CPU_NAME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">NUMBA_CPU_NAME</span></code></a>)</p>
<p>If the cache directory is shared on a network filesystem, concurrent
read/write of the cache is safe only if file replacement operation is atomic
for the filesystem. Numba always writes to a unique temporary file first, it
then replaces the target cache file path with the temporary file. Numba is
tolerant against lost cache files and lost cache entries.</p>
</div>
<div class="section" id="cache-clearing">
<span id="id2"></span><h3>7.14.1.5. Cache Clearing<a class="headerlink" href="#cache-clearing" title="Permalink to this headline">¶</a></h3>
<p>The cache is invalidated when the corresponding source file is modified.
However, it is necessary sometimes to clear the cache directory manually.
For instance, changes in the compiler will not be recognized because the source
files are not modified.</p>
<p>To clear the cache, the cache directory can be simply removed.</p>
<p>Removing the cache directory when a Numba application is running may cause an
<code class="docutils literal notranslate"><span class="pre">OSError</span></code> exception to be raised at the compilation site.</p>
</div>
<div class="section" id="related-environment-variables">
<h3>7.14.1.6. Related Environment Variables<a class="headerlink" href="#related-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="../reference/envvars.html#numba-envvars-caching"><span class="std std-ref">env-vars for caching</span></a>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012, Anaconda, Inc..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>