<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Extending the Numba Frontend &mdash; numba 0.16.0_13_g6d06c8c-py2.7-linux-x86_64.egg documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="../_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="../_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../',
            VERSION:     '0.16.0_13_g6d06c8c-py2.7-linux-x86_64.egg',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="numba 0.16.0_13_g6d06c8c-py2.7-linux-x86_64.egg documentation" href="../index.html" />
    <link rel="next" title="Code Generation Utilties" href="cgutils.html" />
    <link rel="prev" title="Numba Architecture" href="architecture.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">numba 0.16.0_13_g6d06c8c-py2.7-linux-x86_64.egg documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="../genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="../py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="cgutils.html" title="Code Generation Utilties" accesskey="N">next</a>
                </li>
                <li>
                <a href="architecture.html" title="Numba Architecture" accesskey="P">previous</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending the Numba Frontend</a><ul>
<li><a class="reference internal" href="#concepts">Concepts</a><ul>
<li><a class="reference internal" href="#numba-types">Numba Types</a></li>
<li><a class="reference internal" href="#mapping-python-types-to-numba-types">Mapping Python Types to Numba Types</a></li>
<li><a class="reference internal" href="#type-signatures">Type Signatures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tasks">Tasks</a><ul>
<li><a class="reference internal" href="#organizing-type-signatures-with-a-registry">Organizing Type Signatures with a Registry</a></li>
<li><a class="reference internal" href="#creating-a-new-numba-type">Creating a New Numba Type</a></li>
<li><a class="reference internal" href="#adding-an-attribute-value-type-signature">Adding an Attribute Value Type Signature</a></li>
<li><a class="reference internal" href="#adding-a-function-type-signature">Adding a Function Type Signature</a></li>
<li><a class="reference internal" href="#overloading-elementary-operations">Overloading Elementary Operations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="architecture.html"
                        title="previous chapter">Numba Architecture</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cgutils.html"
                        title="next chapter">Code Generation Utilties</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/developer/extend_frontend.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending the Numba Frontend</a><ul>
<li><a class="reference internal" href="#concepts">Concepts</a><ul>
<li><a class="reference internal" href="#numba-types">Numba Types</a></li>
<li><a class="reference internal" href="#mapping-python-types-to-numba-types">Mapping Python Types to Numba Types</a></li>
<li><a class="reference internal" href="#type-signatures">Type Signatures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tasks">Tasks</a><ul>
<li><a class="reference internal" href="#organizing-type-signatures-with-a-registry">Organizing Type Signatures with a Registry</a></li>
<li><a class="reference internal" href="#creating-a-new-numba-type">Creating a New Numba Type</a></li>
<li><a class="reference internal" href="#adding-an-attribute-value-type-signature">Adding an Attribute Value Type Signature</a></li>
<li><a class="reference internal" href="#adding-a-function-type-signature">Adding a Function Type Signature</a></li>
<li><a class="reference internal" href="#overloading-elementary-operations">Overloading Elementary Operations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="architecture.html"
                        title="previous chapter">Numba Architecture</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cgutils.html"
                        title="next chapter">Code Generation Utilties</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/developer/extend_frontend.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="extending-the-numba-frontend">
<h1>Extending the Numba Frontend<a class="headerlink" href="#extending-the-numba-frontend" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The Numba APIs described in this document are not currently guaranteed to be stable.  External packages that rely on these APIs may break with new Numba releases.</p>
</div>
<div class="section" id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>The frontend of Numba analyzes the control flow of a function and performs
type inference in order to (attempt to) deduce the types of all intermediate
values in the function and identify points where types must be coerced.</p>
<div class="section" id="numba-types">
<h3>Numba Types<a class="headerlink" href="#numba-types" title="Permalink to this headline">¶</a></h3>
<p>A Numba type is really a category label for values that is used by the back-
end to match appropriate code generators with the values they operate on. All
Numba types are instances of classes that inherit from <tt class="docutils literal"><span class="pre">numba.types.Type</span></tt>.
Numba types can be parameterized (for example, arrays and records), in which
case their Type classes will take constructor arguments defining the
parameters.  Different instances of a parameterized type usually denote
distinct types and can trigger different, specialized code generation in the
backend.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the rest of this document, when we refer to a &#8220;type&#8221;, we mean the Numba type unless we explicitly write &#8220;Python type&#8221;.</p>
</div>
</div>
<div class="section" id="mapping-python-types-to-numba-types">
<h3>Mapping Python Types to Numba Types<a class="headerlink" href="#mapping-python-types-to-numba-types" title="Permalink to this headline">¶</a></h3>
<p>Although the <tt class="docutils literal"><span class="pre">&#64;jit</span></tt> decorator allows explicit declarations of the Numba
types in a function signature, sometimes Numba needs to infer the Numba type
associated with a particular Python type.  If automatic JIT compilation is
being used, then Numba will determine the types of function arguments from
the Python values passed as function arguments.  Additionally, if a
function accesses global variables, Numba types will also be inferred from
the Python values of those globals.</p>
</div>
<div class="section" id="type-signatures">
<h3>Type Signatures<a class="headerlink" href="#type-signatures" title="Permalink to this headline">¶</a></h3>
<p>Once the types of all the externally defined values (function arguments and
globals) have been specified, the type inference engine needs to propagate
these types through all of the expressions in the function.</p>
<p>Numba needs type signatures for:</p>
<ul class="simple">
<li>Object attributes: This can include the attributes of instances of Python
classes, or modules.</li>
<li>Global values: Objects (such as functions) accessed from the global
namespace.</li>
<li>Operators and other &#8220;implicit&#8221; functions: Certain Python syntax
(like <tt class="docutils literal"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></tt>, or  <tt class="docutils literal"><span class="pre">iter(o)</span></tt>) triggers special function calls.
To overload these operations, a type signature for the appropriate function
must be registered.</li>
<li>Other entities not described in this document, such as builtin functions.</li>
</ul>
</div>
</div>
<div class="section" id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h2>
<p>All of the tasks below will work with an example class and function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Interval</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A half-open interval on the real number line.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="n">lo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Interval(</span><span class="si">%f</span><span class="s">, </span><span class="si">%f</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>

<span class="c"># global function</span>
<span class="k">def</span> <span class="nf">valid_interval</span><span class="p">(</span><span class="n">interval</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return True if interval.lo &lt;= interval.hi&#39;&#39;&#39;</span>
    <span class="k">pass</span>  <span class="c"># This is a stub.  We will implement the function in LLVM</span>
</pre></div>
</div>
<div class="section" id="organizing-type-signatures-with-a-registry">
<h3>Organizing Type Signatures with a Registry<a class="headerlink" href="#organizing-type-signatures-with-a-registry" title="Permalink to this headline">¶</a></h3>
<p>If you have a lot of type signatures in a module, it can be cumbersome to make
type information easily portable between targets. The
<tt class="docutils literal"><span class="pre">numba.typing.templates.Registry</span></tt> class simplifies this process by
collecting lists of attribute, global and operator type signatures that can be
installed into a typing context all at once.</p>
<p>A common pattern in the Numba code is to collect all the type information for
a particular package into a module that begins with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba.typing.templates</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AttributeTemplate</span><span class="p">,</span> <span class="n">ConcreteTemplate</span><span class="p">,</span>
                                    <span class="n">signature</span><span class="p">,</span> <span class="n">Registry</span><span class="p">)</span>

<span class="n">registry</span> <span class="o">=</span> <span class="n">Registry</span><span class="p">()</span>  <span class="c"># A new registry for our new set of types</span>
<span class="n">builtin</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">register</span>
<span class="n">builtin_attr</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">register_attr</span>
<span class="n">builtin_global</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">register_global</span>
</pre></div>
</div>
<p>Then those three functions are used to record different type signatures in
the registry (see examples below).  When the registry is fully populated,
it is installed in the typing context:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba.targets.registry</span> <span class="kn">import</span> <span class="n">target_registry</span>

<span class="c"># Assuming the CPU target</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">target_registry</span><span class="p">[</span><span class="s">&#39;cpu&#39;</span><span class="p">]</span>
<span class="n">target</span><span class="o">.</span><span class="n">targetdescr</span><span class="o">.</span><span class="n">typing_context</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">registry</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-new-numba-type">
<h3>Creating a New Numba Type<a class="headerlink" href="#creating-a-new-numba-type" title="Permalink to this headline">¶</a></h3>
<p>To create a new Numba type, subclass <tt class="docutils literal"><span class="pre">numba.types.Type</span></tt> and make a single
instance of it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IntervalType</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IntervalType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Interval&#39;</span><span class="p">)</span>
<span class="n">interval_type</span> <span class="o">=</span> <span class="n">IntervalType</span><span class="p">()</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">interval_type</span></tt> can now be used to declare argument and return types in
<tt class="docutils literal"><span class="pre">&#64;jit</span></tt> decorations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">bool_</span><span class="p">(</span><span class="n">interval_type</span><span class="p">,</span> <span class="n">numba</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">inside</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">interval</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">interval</span><span class="o">.</span><span class="n">hi</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The string form of the JIT signature <tt class="docutils literal"><span class="pre">&#64;jit(&quot;bool_(interval_type,</span> <span class="pre">float32)&quot;)</span></tt> cannot be used in the above example unless <tt class="docutils literal"><span class="pre">interval_type</span></tt> has been added to the <tt class="docutils literal"><span class="pre">numba.types</span></tt> module.  This shortcoming will be fixed in a future Numba version.</p>
</div>
</div>
<div class="section" id="adding-an-attribute-value-type-signature">
<h3>Adding an Attribute Value Type Signature<a class="headerlink" href="#adding-an-attribute-value-type-signature" title="Permalink to this headline">¶</a></h3>
<p>We can add type signatures for attributes of instances of <tt class="docutils literal"><span class="pre">Interval</span></tt>, so
that <tt class="docutils literal"><span class="pre">lo</span></tt> and <tt class="docutils literal"><span class="pre">hi</span></tt> are recognized as returning <tt class="docutils literal"><span class="pre">float32</span></tt> types.  This
requires creating a subclass of <tt class="docutils literal"><span class="pre">numba.typing.templates.AttributeTemplate</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba.types</span> <span class="kn">import</span> <span class="n">float32</span>
<span class="kn">from</span> <span class="nn">numba.typing.templates</span> <span class="kn">import</span> <span class="n">AttributeTemplate</span>

<span class="nd">@builtin_attr</span>
<span class="k">class</span> <span class="nc">IntervalAttributes</span><span class="p">(</span><span class="n">AttributeTemplate</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">interval_type</span>

    <span class="c"># We will store the interval bounds as 32-bit floats</span>
    <span class="n">_attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="n">float32</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generic_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">key</span></tt> attribute of the template contains the Numba type that needs to be
matched to use this template.  It can either be an instance of a <tt class="docutils literal"><span class="pre">Type</span></tt>
subclass, or the subclass itself, for parametric types.</p>
<p>The <tt class="docutils literal"><span class="pre">AttributeTemplate</span></tt> will first look for a method of the form
<tt class="docutils literal"><span class="pre">resolve_&lt;attribute</span> <span class="pre">name&gt;</span></tt> to get the type of a specific attribute,
otherwise it will delegate to the <tt class="docutils literal"><span class="pre">generic_resolve()</span></tt> method.  This call
takes both the Numba type instance (useful for parametric types) of the value
being accessed, and the name of the attribute.  The return value from
<tt class="docutils literal"><span class="pre">generic_resolve()</span></tt> is the type of the value returned by the attribute
access.</p>
</div>
<div class="section" id="adding-a-function-type-signature">
<h3>Adding a Function Type Signature<a class="headerlink" href="#adding-a-function-type-signature" title="Permalink to this headline">¶</a></h3>
<p>In order for the Numba type inference engine to recognize the
<tt class="docutils literal"><span class="pre">valid_interval</span></tt> global function, we need to provide a type signature for
it.  This is done using a <tt class="docutils literal"><span class="pre">numba.typing.templates.ConcreteTemplate</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba.types</span> <span class="kn">import</span> <span class="n">bool_</span><span class="p">,</span> <span class="n">Function</span>
<span class="kn">from</span> <span class="nn">numba.targets.registry</span> <span class="kn">import</span> <span class="n">target_registry</span>
<span class="kn">from</span> <span class="nn">numba.typing.templates</span> <span class="kn">import</span> <span class="n">ConcreteTemplate</span><span class="p">,</span> <span class="n">signature</span>

<span class="c"># Assuming the CPU target</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">target_registry</span><span class="p">[</span><span class="s">&#39;cpu&#39;</span><span class="p">]</span>
<span class="n">typing_context</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">targetdescr</span><span class="o">.</span><span class="n">typing_context</span>

<span class="k">class</span> <span class="nc">ValidIntervalSignature</span><span class="p">(</span><span class="n">ConcreteTemplate</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">valid_interval</span>
    <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">signature</span><span class="p">(</span><span class="n">bool_</span><span class="p">,</span> <span class="n">interval_type</span><span class="p">)</span>
    <span class="p">]</span>

<span class="n">builtin_global</span><span class="p">(</span><span class="n">valid_interval</span><span class="p">,</span> <span class="n">Function</span><span class="p">(</span><span class="n">ValidIntervalSignature</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">key</span></tt> for looking up the function type is the Python function itself,
<tt class="docutils literal"><span class="pre">valid_interval</span></tt> in this example.  The <tt class="docutils literal"><span class="pre">cases</span></tt> attribute lists all of the
supported function signature combinations.  The first argument to
<tt class="docutils literal"><span class="pre">signature</span></tt> is the return type, and the remaining arguments are the types of
the function arguments.  Only positional arguments are supported for function
types (i.e. no keyword arguments).</p>
</div>
<div class="section" id="overloading-elementary-operations">
<h3>Overloading Elementary Operations<a class="headerlink" href="#overloading-elementary-operations" title="Permalink to this headline">¶</a></h3>
<p>Suppose we want to add support for a <tt class="docutils literal"><span class="pre">+</span></tt> operation between two intervals.
We need to make a <tt class="docutils literal"><span class="pre">ConcreteTemplate</span></tt> where the key is the string <tt class="docutils literal"><span class="pre">&quot;+&quot;</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba.targets.registry</span> <span class="kn">import</span> <span class="n">target_registry</span>
<span class="kn">from</span> <span class="nn">numba.typing.templates</span> <span class="kn">import</span> <span class="n">ConcreteTemplate</span><span class="p">,</span> <span class="n">signature</span>

<span class="c"># Assuming the CPU target</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">target_registry</span><span class="p">[</span><span class="s">&#39;cpu&#39;</span><span class="p">]</span>
<span class="n">typing_context</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">targetdescr</span><span class="o">.</span><span class="n">typing_context</span>

<span class="nd">@builtin</span>
<span class="k">class</span> <span class="nc">AdditionSignature</span><span class="p">(</span><span class="n">ConcreteTemplate</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
    <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">signature</span><span class="p">(</span><span class="n">interval_type</span><span class="p">,</span> <span class="n">interval_type</span><span class="p">,</span> <span class="n">interval_type</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Several templates with the same key can be inserted, and each will be checked
for a matching function signatures in the order of insertion. This is what
allows the same key to be overloaded with different numbers of arguments and
different argument types.</p>
<p>The list of special function keys includes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">+</span></tt></td>
<td>Addition (2 args) and unary positive (1 arg)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-</span></tt></td>
<td>Subtraction (2 args) and unary negative (1 arg)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">*</span></tt></td>
<td>Multiplication</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">/?</span></tt></td>
<td>Divide (only Python 2)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">/</span></tt></td>
<td>True divide</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">//</span></tt></td>
<td>Floor divide</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">%</span></tt></td>
<td>Modulo</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">**</span></tt></td>
<td>Power</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&lt;&lt;</span></tt></td>
<td>Left shift</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">&gt;&gt;</span></tt></td>
<td>Right shift</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">&amp;</span></tt></td>
<td>Bitwise AND</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">|</span></tt></td>
<td>Bitwise OR</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">^</span></tt></td>
<td>Bitwise XOR</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">getiter</span></tt></td>
<td>Get an iterator (equivalent to <tt class="docutils literal"><span class="pre">__iter__()</span></tt>)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">iternext</span></tt></td>
<td>Return the next element from an iterator (equivalent to <tt class="docutils literal"><span class="pre">__next__()</span></tt>)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">getitem</span></tt></td>
<td>Get an item (equivalent to <tt class="docutils literal"><span class="pre">__getitem__()</span></tt>)</td>
</tr>
</tbody>
</table>
<p>These keys come directly from operations in the Numba IR (see <a class="reference internal" href="architecture.html#arch-generate-numba-ir"><em>Stage 2: Generate the Numba IR</em></a>).</p>
<p>In-place operations (like <tt class="docutils literal"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">b</span></tt>) are assumed to have the same signature
as the right-hand side of the expanded form (<tt class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></tt>).</p>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="../genindex.html" title="General Index" >index</a></li>
        <li><a href="../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="cgutils.html" title="Code Generation Utilties" >next</a></li>
        <li><a href="architecture.html" title="Numba Architecture" >previous</a></li>
        <li><a href="../index.html">numba 0.16.0_13_g6d06c8c-py2.7-linux-x86_64.egg documentation</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2014, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>