<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>1.3. Compiling Python code with @jit &mdash; Numba 0.21.0+370.gece941f-py2.7-linux-x86_64.egg documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="../_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="../_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../',
            VERSION:     '0.21.0+370.gece941f-py2.7-linux-x86_64.egg',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="Numba 0.21.0+370.gece941f-py2.7-linux-x86_64.egg documentation" href="../index.html" />
    <link rel="up" title="1. User Manual" href="index.html" />
    <link rel="next" title="1.4. Creating Numpy universal functions" href="vectorize.html" />
    <link rel="prev" title="1.2. Getting started" href="installing.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Numba 0.21.0+370.gece941f-py2.7-linux-x86_64.egg documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="../genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="vectorize.html" title="1.4. Creating Numpy universal functions" accesskey="N">next</a>
                </li>
                <li>
                <a href="installing.html" title="1.2. Getting started" accesskey="P">previous</a>
                </li>
                <li>
                <a href="index.html" accesskey="U">1. User Manual</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.3. Compiling Python code with <code class="docutils literal"><span class="pre">&#64;jit</span></code></a><ul>
<li><a class="reference internal" href="#basic-usage">1.3.1. Basic usage</a><ul>
<li><a class="reference internal" href="#lazy-compilation">1.3.1.1. Lazy compilation</a></li>
<li><a class="reference internal" href="#eager-compilation">1.3.1.2. Eager compilation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calling-and-inlining-other-functions">1.3.2. Calling and inlining other functions</a></li>
<li><a class="reference internal" href="#signature-specifications">1.3.3. Signature specifications</a></li>
<li><a class="reference internal" href="#compilation-options">1.3.4. Compilation options</a><ul>
<li><a class="reference internal" href="#nopython">1.3.4.1. <code class="docutils literal"><span class="pre">nopython</span></code></a></li>
<li><a class="reference internal" href="#nogil">1.3.4.2. <code class="docutils literal"><span class="pre">nogil</span></code></a></li>
<li><a class="reference internal" href="#cache">1.3.4.3. <code class="docutils literal"><span class="pre">cache</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installing.html"
                        title="previous chapter">1.2. Getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vectorize.html"
                        title="next chapter">1.4. Creating Numpy universal functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/jit.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.3. Compiling Python code with <code class="docutils literal"><span class="pre">&#64;jit</span></code></a><ul>
<li><a class="reference internal" href="#basic-usage">1.3.1. Basic usage</a><ul>
<li><a class="reference internal" href="#lazy-compilation">1.3.1.1. Lazy compilation</a></li>
<li><a class="reference internal" href="#eager-compilation">1.3.1.2. Eager compilation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calling-and-inlining-other-functions">1.3.2. Calling and inlining other functions</a></li>
<li><a class="reference internal" href="#signature-specifications">1.3.3. Signature specifications</a></li>
<li><a class="reference internal" href="#compilation-options">1.3.4. Compilation options</a><ul>
<li><a class="reference internal" href="#nopython">1.3.4.1. <code class="docutils literal"><span class="pre">nopython</span></code></a></li>
<li><a class="reference internal" href="#nogil">1.3.4.2. <code class="docutils literal"><span class="pre">nogil</span></code></a></li>
<li><a class="reference internal" href="#cache">1.3.4.3. <code class="docutils literal"><span class="pre">cache</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installing.html"
                        title="previous chapter">1.2. Getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vectorize.html"
                        title="next chapter">1.4. Creating Numpy universal functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/jit.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="compiling-python-code-with-jit">
<span id="jit"></span><h1>1.3. Compiling Python code with <code class="docutils literal"><span class="pre">&#64;jit</span></code><a class="headerlink" href="#compiling-python-code-with-jit" title="Permalink to this headline">¶</a></h1>
<p>Numba provides several utilities for code generation, but its central
feature is the <a class="reference internal" href="../reference/jit-compilation.html#numba.jit" title="numba.jit"><code class="xref py py-func docutils literal"><span class="pre">numba.jit()</span></code></a> decorator.  Using this decorator, you can mark
a function for optimization by Numba&#8217;s JIT compiler.  Various invocation
modes trigger differing compilation options and behaviours.</p>
<div class="section" id="basic-usage">
<h2>1.3.1. Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="lazy-compilation">
<span id="jit-lazy"></span><h3>1.3.1.1. Lazy compilation<a class="headerlink" href="#lazy-compilation" title="Permalink to this headline">¶</a></h3>
<p>The recommended way to use the <code class="docutils literal"><span class="pre">&#64;jit</span></code> decorator is to let Numba decide
when and how to optimize:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c"># A somewhat trivial example</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>In this mode, compilation will be deferred until the first function
execution.  Numba will infer the argument types at call time, and generate
optimized code based on this information.  Numba will also be able to
compile separate specializations depending on the input types.  For example,
calling the <code class="docutils literal"><span class="pre">f()</span></code> function above with integer or complex numbers will
generate different code paths:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">(2+1j)</span>
</pre></div>
</div>
</div>
<div class="section" id="eager-compilation">
<h3>1.3.1.2. Eager compilation<a class="headerlink" href="#eager-compilation" title="Permalink to this headline">¶</a></h3>
<p>You can also tell Numba the function signature you are expecting.  The
function <code class="docutils literal"><span class="pre">f()</span></code> would now look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">int32</span>

<span class="nd">@jit</span><span class="p">(</span><span class="n">int32</span><span class="p">(</span><span class="n">int32</span><span class="p">,</span> <span class="n">int32</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c"># A somewhat trivial example</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">int32(int32,</span> <span class="pre">int32)</span></code> is the function&#8217;s signature.  In this case, the
corresponding specialization will be compiled by the <code class="docutils literal"><span class="pre">&#64;jit</span></code> decorator,
and no other specialization will be allowed. This is useful if you want
fine-grained control over types chosen by the compiler (for example,
to use single-precision floats).</p>
<p>If you omit the return type, e.g. by writing <code class="docutils literal"><span class="pre">(int32,</span> <span class="pre">int32)</span></code> instead of
<code class="docutils literal"><span class="pre">int32(int32,</span> <span class="pre">int32)</span></code>, Numba will try to infer it for you.  Function
signatures can also be strings, and you can pass several of them as a list;
see the <a class="reference internal" href="../reference/jit-compilation.html#numba.jit" title="numba.jit"><code class="xref py py-func docutils literal"><span class="pre">numba.jit()</span></code></a> documentation for more details.</p>
<p>Of course, the compiled function gives the expected results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>and if we specified <code class="docutils literal"><span class="pre">int32</span></code> as return type, the higher-order bits get
discarded:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="calling-and-inlining-other-functions">
<h2>1.3.2. Calling and inlining other functions<a class="headerlink" href="#calling-and-inlining-other-functions" title="Permalink to this headline">¶</a></h2>
<p>Numba-compiled functions can call other compiled functions.  The function
calls may even be inlined in the native code, depending on optimizer
heuristics.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&#64;jit</span></code> decorator <em>must</em> be added to any such library function,
otherwise Numba may generate much slower code.</p>
</div>
<div class="section" id="signature-specifications">
<h2>1.3.3. Signature specifications<a class="headerlink" href="#signature-specifications" title="Permalink to this headline">¶</a></h2>
<p>Explicit <code class="docutils literal"><span class="pre">&#64;jit</span></code> signatures can use a number of types.  Here are some
common ones:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">void</span></code> is the return type of functions returning nothing (which
actually return <code class="xref py py-const docutils literal"><span class="pre">None</span></code> when called from Python)</li>
<li><code class="docutils literal"><span class="pre">intp</span></code> and <code class="docutils literal"><span class="pre">uintp</span></code> are pointer-sized integers (signed and unsigned,
respectively)</li>
<li><code class="docutils literal"><span class="pre">intc</span></code> and <code class="docutils literal"><span class="pre">uintc</span></code> are equivalent to C <code class="docutils literal"><span class="pre">int</span></code> and <code class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span></code>
integer types</li>
<li><code class="docutils literal"><span class="pre">int8</span></code>, <code class="docutils literal"><span class="pre">uint8</span></code>, <code class="docutils literal"><span class="pre">int16</span></code>, <code class="docutils literal"><span class="pre">uint16</span></code>, <code class="docutils literal"><span class="pre">int32</span></code>, <code class="docutils literal"><span class="pre">uint32</span></code>,
<code class="docutils literal"><span class="pre">int64</span></code>, <code class="docutils literal"><span class="pre">uint64</span></code> are fixed-width integers of the corresponding bit
width (signed and unsigned)</li>
<li><code class="docutils literal"><span class="pre">float32</span></code> and <code class="docutils literal"><span class="pre">float64</span></code> are single- and double-precision floating-point
numbers, respectively</li>
<li><code class="docutils literal"><span class="pre">complex64</span></code> and <code class="docutils literal"><span class="pre">complex128</span></code> are single- and double-precision complex
numbers, respectively</li>
<li>array types can be specified by indexing any numeric type, e.g. <code class="docutils literal"><span class="pre">float32[:]</span></code>
for a one-dimensional single-precision array or <code class="docutils literal"><span class="pre">int8[:,:]</span></code> for a
two-dimensional array of 8-bit integers.</li>
</ul>
</div>
<div class="section" id="compilation-options">
<h2>1.3.4. Compilation options<a class="headerlink" href="#compilation-options" title="Permalink to this headline">¶</a></h2>
<p>A number of keyword-only arguments can be passed to the <code class="docutils literal"><span class="pre">&#64;jit</span></code> decorator.</p>
<div class="section" id="nopython">
<span id="jit-nopython"></span><h3>1.3.4.1. <code class="docutils literal"><span class="pre">nopython</span></code><a class="headerlink" href="#nopython" title="Permalink to this headline">¶</a></h3>
<p>Numba has two compilation modes: <a class="reference internal" href="../glossary.html#term-nopython-mode"><span class="xref std std-term">nopython mode</span></a> and
<a class="reference internal" href="../glossary.html#term-object-mode"><span class="xref std std-term">object mode</span></a>.  The former produces much faster code, but has
limitations that can force Numba to fall back to the latter.  To prevent
Numba from falling back, and instead raise an error, pass <code class="docutils literal"><span class="pre">nopython=True</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="troubleshoot.html#troubleshooting"><span>Troubleshooting and tips</span></a></p>
</div>
</div>
<div class="section" id="nogil">
<span id="jit-nogil"></span><h3>1.3.4.2. <code class="docutils literal"><span class="pre">nogil</span></code><a class="headerlink" href="#nogil" title="Permalink to this headline">¶</a></h3>
<p>Whenever Numba optimizes Python code to native code that only works on
native types and variables (rather than Python objects), it is not necessary
anymore to hold Python&#8217;s <a class="reference external" href="https://docs.python.org/3/glossary.html#term-global-interpreter-lock" title="(in Python v3.5)"><span class="xref std std-term">global interpreter lock</span></a> (GIL).
Numba will release the GIL when entering such a compiled function if you
passed <code class="docutils literal"><span class="pre">nogil=True</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span><span class="p">(</span><span class="n">nogil</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>Code running with the GIL released runs concurrently with other
threads executing Python or Numba code (either the same compiled function,
or another one), allowing you to take advantage of multi-core systems.
This will not be possible if the function is compiled in <a class="reference internal" href="../glossary.html#term-object-mode"><span class="xref std std-term">object mode</span></a>.</p>
<p>When using <code class="docutils literal"><span class="pre">nogil=True</span></code>, you&#8217;ll have to be wary of the usual pitfalls
of multi-threaded programming (consistency, synchronization, race conditions,
etc.).</p>
</div>
<div class="section" id="cache">
<span id="jit-cache"></span><h3>1.3.4.3. <code class="docutils literal"><span class="pre">cache</span></code><a class="headerlink" href="#cache" title="Permalink to this headline">¶</a></h3>
<p>To avoid compilation times each time you invoke a Python program,
you can instruct Numba to write the result of function compilation into
a file-based cache.  This is done by passing <code class="docutils literal"><span class="pre">cache=True</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="../genindex.html" title="General Index" >index</a></li>
        <li><a href="vectorize.html" title="1.4. Creating Numpy universal functions" >next</a></li>
        <li><a href="installing.html" title="1.2. Getting started" >previous</a></li>
        <li><a href="../index.html">Numba 0.21.0+370.gece941f-py2.7-linux-x86_64.egg documentation</a></li>
        <li><a href="index.html" >1. User Manual</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2015, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>