<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.11. Using the @stencil decorator &mdash; Numba 0.40.0.dev0+646.g307bedc-py2.7-linux-x86_64.egg documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/numba-docs.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.40.0.dev0+646.g307bedc-py2.7-linux-x86_64.egg',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Numba 0.40.0.dev0+646.g307bedc-py2.7-linux-x86_64.egg documentation" href="../index.html" />
    <link rel="up" title="1. User Manual" href="index.html" />
    <link rel="next" title="1.12. Callback into the Python Interpreter from within JIT’ed code" href="withobjmode.html" />
    <link rel="prev" title="1.10. Automatic parallelization with @jit" href="parallel.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/numba_blue_icon_rgb.png"></span>
          Numba</a>
        <span class="navbar-text navbar-version pull-left"><b>0.40</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">1. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">2. Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/index.html">3. Numba for CUDA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roc/index.html">5. Numba for AMD ROC GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">1.11. Using the <code class="docutils literal"><span class="pre">&#64;stencil</span></code> decorator</a><ul>
<li><a class="reference internal" href="#basic-usage">1.11.1. Basic usage</a></li>
<li><a class="reference internal" href="#stencil-parameters">1.11.2. Stencil Parameters</a></li>
<li><a class="reference internal" href="#kernel-shape-inference-and-border-handling">1.11.3. Kernel shape inference and border handling</a></li>
<li><a class="reference internal" href="#stencil-decorator-options">1.11.4. Stencil decorator options</a><ul>
<li><a class="reference internal" href="#neighborhood">1.11.4.1. <code class="docutils literal"><span class="pre">neighborhood</span></code></a></li>
<li><a class="reference internal" href="#mode">1.11.4.2. <code class="docutils literal"><span class="pre">mode</span></code></a></li>
<li><a class="reference internal" href="#cval">1.11.4.3. <code class="docutils literal"><span class="pre">cval</span></code></a></li>
<li><a class="reference internal" href="#standard-indexing">1.11.4.4. <code class="docutils literal"><span class="pre">standard_indexing</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#stencilfunc">1.11.5. <code class="docutils literal"><span class="pre">StencilFunc</span></code></a></li>
<li><a class="reference internal" href="#stencil-invocation-options">1.11.6. Stencil invocation options</a><ul>
<li><a class="reference internal" href="#out">1.11.6.1. <code class="docutils literal"><span class="pre">out</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="parallel.html" title="Previous Chapter: 1.10. Automatic parallelization with @jit"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 1.10. Automatic ...</span>
    </a>
  </li>
  <li>
    <a href="withobjmode.html" title="Next Chapter: 1.12. Callback into the Python Interpreter from within JIT’ed code"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">1.12. Callback i... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/user/stencil.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="using-the-stencil-decorator">
<span id="numba-stencil"></span><h1>1.11. Using the <code class="docutils literal"><span class="pre">&#64;stencil</span></code> decorator<a class="headerlink" href="#using-the-stencil-decorator" title="Permalink to this headline">¶</a></h1>
<p>Stencils are a common computational pattern in which array elements
are updated according to some fixed pattern called the stencil kernel.
Numba provides the <code class="docutils literal"><span class="pre">&#64;stencil</span></code> decorator so that users may
easily specify a stencil kernel and Numba then generates the looping
code necessary to apply that kernel to some input array.  Thus, the
stencil decorator allows clearer, more concise code and in conjunction
with <a class="reference internal" href="jit.html#parallel-jit-option"><span>the parallel jit option</span></a> enables higher
performance through parallelization of the stencil execution.</p>
<div class="section" id="basic-usage">
<h2>1.11.1. Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>An example use of the <code class="docutils literal"><span class="pre">&#64;stencil</span></code> decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">stencil</span>

<span class="nd">@stencil</span>
<span class="k">def</span> <span class="nf">kernel1</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>The stencil kernel is specified by what looks like a standard Python
function definition but there are different semantics with
respect to array indexing.
Stencils produce an output array of the same size and shape as the
input array although depending on the kernel definition may have a
different type.
Conceptually, the stencil kernel is run once for each element in the
output array.  The return value from the stencil kernel is the value
written into the output array for that particular element.</p>
<p>The parameter <code class="docutils literal"><span class="pre">a</span></code> represents the input array over which the
kernel is applied.
Indexing into this array takes place with respect to the current element
of the output array being processed.  For example, if element <code class="docutils literal"><span class="pre">(x,</span> <span class="pre">y)</span></code>
is being processed then <code class="docutils literal"><span class="pre">a[0,</span> <span class="pre">0]</span></code> in the stencil kernel corresponds to
<code class="docutils literal"><span class="pre">a[x</span> <span class="pre">+</span> <span class="pre">0,</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">0]</span></code> in the input array.  Similarly, <code class="docutils literal"><span class="pre">a[-1,</span> <span class="pre">1]</span></code> in the stencil
kernel corresponds to <code class="docutils literal"><span class="pre">a[x</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">1]</span></code> in the input array.</p>
<p>Depending on the specified kernel, the kernel may not be applicable to the
borders of the output array as this may cause the input array to be
accessed out-of-bounds.  The way in which the stencil decorator handles
this situation is dependent upon which <a class="reference internal" href="#stencil-mode"><span>mode</span></a> is selected.
The default mode is for the stencil decorator to set the border elements
of the output array to zero.</p>
<p>To invoke a stencil on an input array, call the stencil as if it were
a regular function and pass the input array as the argument. For example, using
the kernel defined above:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="go">array([[ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9],</span>
<span class="go">       [10, 11, 12, 13, 14, 15, 16, 17, 18, 19],</span>
<span class="go">       [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],</span>
<span class="go">       [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],</span>
<span class="go">       [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],</span>
<span class="go">       [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],</span>
<span class="go">       [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],</span>
<span class="go">       [70, 71, 72, 73, 74, 75, 76, 77, 78, 79],</span>
<span class="go">       [80, 81, 82, 83, 84, 85, 86, 87, 88, 89],</span>
<span class="go">       [90, 91, 92, 93, 94, 95, 96, 97, 98, 99]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_arr</span> <span class="o">=</span> <span class="n">kernel1</span><span class="p">(</span><span class="n">input_arr</span><span class="p">)</span>
<span class="go">array([[  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.],</span>
<span class="go">       [  0.,  11.,  12.,  13.,  14.,  15.,  16.,  17.,  18.,   0.],</span>
<span class="go">       [  0.,  21.,  22.,  23.,  24.,  25.,  26.,  27.,  28.,   0.],</span>
<span class="go">       [  0.,  31.,  32.,  33.,  34.,  35.,  36.,  37.,  38.,   0.],</span>
<span class="go">       [  0.,  41.,  42.,  43.,  44.,  45.,  46.,  47.,  48.,   0.],</span>
<span class="go">       [  0.,  51.,  52.,  53.,  54.,  55.,  56.,  57.,  58.,   0.],</span>
<span class="go">       [  0.,  61.,  62.,  63.,  64.,  65.,  66.,  67.,  68.,   0.],</span>
<span class="go">       [  0.,  71.,  72.,  73.,  74.,  75.,  76.,  77.,  78.,   0.],</span>
<span class="go">       [  0.,  81.,  82.,  83.,  84.,  85.,  86.,  87.,  88.,   0.],</span>
<span class="go">       [  0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_arr</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int64&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_arr</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)</span>
</pre></div>
</div>
<p>Note that the stencil decorator has determined that the output type
of the specified stencil kernel is <code class="docutils literal"><span class="pre">float64</span></code> and has thus created the
output array as <code class="docutils literal"><span class="pre">float64</span></code> while the input array is of type <code class="docutils literal"><span class="pre">int64</span></code>.</p>
</div>
<div class="section" id="stencil-parameters">
<h2>1.11.2. Stencil Parameters<a class="headerlink" href="#stencil-parameters" title="Permalink to this headline">¶</a></h2>
<p>Stencil kernel definitions may take any number of arguments with
the following provisions.  The first argument must be an array.
The size and shape of the output array will be the same as that of the
first argument.  Additional arguments may either be scalars or
arrays.  For array arguments, those arrays must be at least as large
as the first argument (array) in each dimension.  Array indexing is relative for
all such input array arguments.</p>
</div>
<div class="section" id="kernel-shape-inference-and-border-handling">
<span id="stencil-kernel-shape-inference"></span><h2>1.11.3. Kernel shape inference and border handling<a class="headerlink" href="#kernel-shape-inference-and-border-handling" title="Permalink to this headline">¶</a></h2>
<p>In the above example and in most cases, the array indexing in the
stencil kernel will exclusively use <code class="docutils literal"><span class="pre">Integer</span></code> literals.
In such cases, the stencil decorator is able to analyze the stencil
kernel to determine its size.  In the above example, the stencil
decorator determines that the kernel is <code class="docutils literal"><span class="pre">3</span> <span class="pre">x</span> <span class="pre">3</span></code> in shape since indices
<code class="docutils literal"><span class="pre">-1</span></code> to <code class="docutils literal"><span class="pre">1</span></code> are used for both the first and second dimensions.  Note that
the stencil decorator also correctly handles non-symmetric and
non-square stencil kernels.</p>
<p>Based on the size of the stencil kernel, the stencil decorator is
able to compute the size of the border in the output array.  If
applying the kernel to some element of input array would cause
an index to be out-of-bounds then that element belongs to the border
of the output array.  In the above example, points <code class="docutils literal"><span class="pre">-1</span></code> and <code class="docutils literal"><span class="pre">+1</span></code> are
accessed in each dimension and thus the output array has a border
of size one in all dimensions.</p>
<p>The parallel mode is able to infer kernel indices as constants from
simple expressions if possible. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">stencil_test</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">stencil</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">]))(</span><span class="n">A</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">B</span>
</pre></div>
</div>
</div>
<div class="section" id="stencil-decorator-options">
<h2>1.11.4. Stencil decorator options<a class="headerlink" href="#stencil-decorator-options" title="Permalink to this headline">¶</a></h2>
<p>While the stencil decorator may be augmented in the future to
provide additional mechanisms for border handling, at the moment
the stencil decorator currently supports only one option.</p>
<div class="section" id="neighborhood">
<span id="stencil-neighborhood"></span><h3>1.11.4.1. <code class="docutils literal"><span class="pre">neighborhood</span></code><a class="headerlink" href="#neighborhood" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it may be inconvenient to write the stencil kernel
exclusively with <code class="docutils literal"><span class="pre">Integer</span></code> literals.  For example, let us say we
would like to compute the trailing 30-day moving average of a
time series of data.  One could write
<code class="docutils literal"><span class="pre">(a[-29]</span> <span class="pre">+</span> <span class="pre">a[-28]</span> <span class="pre">+</span> <span class="pre">...</span> <span class="pre">+</span> <span class="pre">a[-1]</span> <span class="pre">+</span> <span class="pre">a[0])</span> <span class="pre">/</span> <span class="pre">30</span></code> but the stencil
decorator offers a more concise form using the <code class="docutils literal"><span class="pre">neighborhood</span></code>
option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@stencil</span><span class="p">(</span><span class="n">neighborhood</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">),))</span>
<span class="k">def</span> <span class="nf">kernel2</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">cumul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cumul</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cumul</span> <span class="o">/</span> <span class="mi">30</span>
</pre></div>
</div>
<p>The neighborhood option is a tuple of tuples.  The outer tuple&#8217;s
length is equal to the number of dimensions of the input array.
The inner tuple&#8217;s lengths are always two because
each element of the outer tuple corresponds to minimum and
maximum index offsets used in the corresponding dimension.</p>
<p>If a user specifies a neighborhood but the kernel accesses elements outside the
specified neighborhood, <strong>the behavior is undefined.</strong></p>
</div>
<div class="section" id="mode">
<span id="stencil-mode"></span><h3>1.11.4.2. <code class="docutils literal"><span class="pre">mode</span></code><a class="headerlink" href="#mode" title="Permalink to this headline">¶</a></h3>
<p>The optional mode parameter controls how the border of the output array
is handled.  Currently, there is only one supported value, <code class="docutils literal"><span class="pre">&quot;constant&quot;</span></code>.
In <code class="docutils literal"><span class="pre">constant</span></code> mode, the stencil kernel is not applied in cases where
the kernel would access elements outside the valid range of the input
array.  In such cases, those elements in the output array are assigned
to a constant value, as specified by the <code class="docutils literal"><span class="pre">cval</span></code> parameter.</p>
</div>
<div class="section" id="cval">
<h3>1.11.4.3. <code class="docutils literal"><span class="pre">cval</span></code><a class="headerlink" href="#cval" title="Permalink to this headline">¶</a></h3>
<p>The optional cval parameter defaults to zero but can be set to any
desired value, which is then used for the border of the output array
if the mode parameter is set to <code class="docutils literal"><span class="pre">constant</span></code>.  The cval parameter is
ignored in all other modes.  The type of the cval parameter must match
the return type of the stencil kernel.  If the user wishes the output
array to be constructed from a particular type then they should ensure
that the stencil kernel returns that type.</p>
</div>
<div class="section" id="standard-indexing">
<h3>1.11.4.4. <code class="docutils literal"><span class="pre">standard_indexing</span></code><a class="headerlink" href="#standard-indexing" title="Permalink to this headline">¶</a></h3>
<p>By default, all array accesses in a stencil kernel are processed as
relative indices as described above.  However, sometimes it may be
advantageous to pass an auxiliary array (e.g. an array of weights)
to a stencil kernel and have that array use standard Python indexing
rather than relative indexing.  For this purpose, there is the
stencil decorator option <code class="docutils literal"><span class="pre">standard_indexing</span></code> whose value is a
collection of strings whose names match those parameters to the
stencil function that are to be accessed with standard Python indexing
rather than relative indexing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@stencil</span><span class="p">(</span><span class="n">standard_indexing</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,))</span>
<span class="k">def</span> <span class="nf">kernel3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stencilfunc">
<h2>1.11.5. <code class="docutils literal"><span class="pre">StencilFunc</span></code><a class="headerlink" href="#stencilfunc" title="Permalink to this headline">¶</a></h2>
<p>The stencil decorator returns a callable object of type <code class="docutils literal"><span class="pre">StencilFunc</span></code>.
<code class="docutils literal"><span class="pre">StencilFunc</span></code> objects contains a number of attributes but the only one of
potential interest to users is the <code class="docutils literal"><span class="pre">neighborhood</span></code> attribute.
If the <code class="docutils literal"><span class="pre">neighborhood</span></code> option was passed to the stencil decorator then
the provided neighborhood is stored in this attribute.  Else, upon
first execution or compilation, the system calculates the neighborhood
as described above and then stores the computed neighborhood into this
attribute.  A user may then inspect the attribute if they wish to verify
that the calculated neighborhood is correct.</p>
</div>
<div class="section" id="stencil-invocation-options">
<h2>1.11.6. Stencil invocation options<a class="headerlink" href="#stencil-invocation-options" title="Permalink to this headline">¶</a></h2>
<p>Internally, the stencil decorator transforms the specified stencil
kernel into a regular Python function.  This function will have the
same parameters as specified in the stencil kernel definition but will
also include the following optional parameter.</p>
<div class="section" id="out">
<span id="stencil-function-out"></span><h3>1.11.6.1. <code class="docutils literal"><span class="pre">out</span></code><a class="headerlink" href="#out" title="Permalink to this headline">¶</a></h3>
<p>The optional <code class="docutils literal"><span class="pre">out</span></code> parameter is added to every stencil function
generated by Numba.  If specified, the <code class="docutils literal"><span class="pre">out</span></code> parameter tells
Numba that the user is providing their own pre-allocated array
to be used for the output of the stencil.  In this case, the
stencil function will not allocate its own output array.
Users should assure that the return type of the stencil kernel can
be safely cast to the element-type of the user-specified output array
following the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/ufuncs.html#casting-rules">Numpy ufunc casting rules</a>.</p>
<p>An example usage is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">input_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kernel1</span><span class="p">(</span><span class="n">input_arr</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">output_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012, Anaconda, Inc..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>