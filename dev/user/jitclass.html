<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>1.6. Compiling python classes with @jitclass &mdash; Numba 0.24.0+137.g4e7bc9c-py2.7-linux-x86_64.egg documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="../_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="../_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../',
            VERSION:     '0.24.0+137.g4e7bc9c-py2.7-linux-x86_64.egg',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="Numba 0.24.0+137.g4e7bc9c-py2.7-linux-x86_64.egg documentation" href="../index.html" />
    <link rel="up" title="1. User Manual" href="index.html" />
    <link rel="next" title="1.7. Compiling code ahead of time" href="pycc.html" />
    <link rel="prev" title="1.5. Creating Numpy universal functions" href="vectorize.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Numba 0.24.0+137.g4e7bc9c-py2.7-linux-x86_64.egg documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="../genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="../py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="pycc.html" title="1.7. Compiling code ahead of time" accesskey="N">next</a>
                </li>
                <li>
                <a href="vectorize.html" title="1.5. Creating Numpy universal functions" accesskey="P">previous</a>
                </li>
                <li>
                <a href="index.html" accesskey="U">1. User Manual</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.6. Compiling python classes with &#64;jitclass</a><ul>
<li><a class="reference internal" href="#basic-usage">1.6.1. Basic usage</a></li>
<li><a class="reference internal" href="#support-operations">1.6.2. Support operations</a></li>
<li><a class="reference internal" href="#limitations">1.6.3. Limitations</a></li>
<li><a class="reference internal" href="#the-decorator-jitclass">1.6.4. The decorator: <code class="docutils literal"><span class="pre">&#64;jitclass</span></code></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vectorize.html"
                        title="previous chapter">1.5. Creating Numpy universal functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pycc.html"
                        title="next chapter">1.7. Compiling code ahead of time</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/jitclass.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.6. Compiling python classes with &#64;jitclass</a><ul>
<li><a class="reference internal" href="#basic-usage">1.6.1. Basic usage</a></li>
<li><a class="reference internal" href="#support-operations">1.6.2. Support operations</a></li>
<li><a class="reference internal" href="#limitations">1.6.3. Limitations</a></li>
<li><a class="reference internal" href="#the-decorator-jitclass">1.6.4. The decorator: <code class="docutils literal"><span class="pre">&#64;jitclass</span></code></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vectorize.html"
                        title="previous chapter">1.5. Creating Numpy universal functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pycc.html"
                        title="next chapter">1.7. Compiling code ahead of time</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/jitclass.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="compiling-python-classes-with-jitclass">
<span id="jitclass"></span><h1>1.6. Compiling python classes with &#64;jitclass<a class="headerlink" href="#compiling-python-classes-with-jitclass" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a early version of jitclass support. Not all compiling features are
exposed or implemented, yet.</p>
</div>
<p>Numba supports code generation for classes via the <a class="reference internal" href="#numba.jitclass" title="numba.jitclass"><code class="xref py py-func docutils literal"><span class="pre">numba.jitclass()</span></code></a>
decorator.  A class can be marked for optimization using this decorator along
with a specification of the types of each field.  We call the resulting class
object a jitclass.  All methods of a jitclass is compiled into nopython
functions.  The data of a jitclass instance is allocated on the heap as a
C-compatible structure so that any compiled functions can have direct access
to the underlying data, bypassing the interpreter.</p>
<div class="section" id="basic-usage">
<h2>1.6.1. Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s an example of a jitclass:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jitclass</span>          <span class="c"># import the decorator</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">int32</span><span class="p">,</span> <span class="n">float32</span>    <span class="c"># import the types</span>

<span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">int32</span><span class="p">),</span>               <span class="c"># a simple scalar field</span>
    <span class="p">(</span><span class="s">&#39;array&#39;</span><span class="p">,</span> <span class="n">float32</span><span class="p">[:]),</span>          <span class="c"># an array field</span>
<span class="p">]</span>

<span class="nd">@jitclass</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Bag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</pre></div>
</div>
<p>(see full example at <cite>examples/jitclass.py</cite> from the source tree)</p>
<p>In the above example, a <code class="docutils literal"><span class="pre">spec</span></code> is provided as a list of 2-tuples.  The tuples
contain the name of the field and the numba type of the field.  Alternatively,
user can use a dictionary (an <code class="docutils literal"><span class="pre">OrderedDict</span></code> preferrably for stable field
ordering), which maps field names to types.</p>
<p>The definition of the class requires at least a <code class="docutils literal"><span class="pre">__init__</span></code> method for
initializing each defined fields.  Uninitialized fields contains garbage data.
Methods and properties (getters and setters only) can be defined.  They will be
automatically compiled.</p>
</div>
<div class="section" id="support-operations">
<h2>1.6.2. Support operations<a class="headerlink" href="#support-operations" title="Permalink to this headline">¶</a></h2>
<p>The following operations of jitclasses work in both the interpreter and numba
compiled functions:</p>
<ul class="simple">
<li>calling the jitclass class object to construct a new instance
(e.g. <code class="docutils literal"><span class="pre">mybag</span> <span class="pre">=</span> <span class="pre">Bag(123)</span></code>);</li>
<li>read/write access to attributes and properties (e.g. <code class="docutils literal"><span class="pre">mybag.value</span></code>);</li>
<li>calling methods (e.g. <code class="docutils literal"><span class="pre">mybag.increment(3)</span></code>);</li>
</ul>
<p>Using jitclasses in numba compiled function is more efficient.
Short methods can be inlined (at the discretion of LLVM inliner).
Attributes access are simply reading from a C structure.
Using jitclasses from the intpreter has the same overhead of calling any
numba compiled function from the interpreter.  Arguments and return values
must be unboxed or boxed between python objects and native representation.
Values encapsulated by a jitclass does not get boxed into python object when
the jitclass instance is handed to the interpreter.  It is during attribute
access to the field values that they are boxed.</p>
</div>
<div class="section" id="limitations">
<h2>1.6.3. Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>A jitclass class object is treated as a function (the constructor) inside
a numba compiled function.</li>
<li><code class="docutils literal"><span class="pre">isinstance()</span></code> only works in the interpreter.</li>
<li>Manipulating jitclass instances in the interpreter is not optimized, yet.</li>
<li>Support for jitclasses are available on CPU only.
(Note: Support for GPU devices is planned for a future release.)</li>
</ul>
</div>
<div class="section" id="the-decorator-jitclass">
<h2>1.6.4. The decorator: <code class="docutils literal"><span class="pre">&#64;jitclass</span></code><a class="headerlink" href="#the-decorator-jitclass" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="numba.jitclass">
<code class="descclassname">numba.</code><code class="descname">jitclass</code><span class="sig-paren">(</span><em>spec</em><span class="sig-paren">)</span><a class="headerlink" href="#numba.jitclass" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator for creating a jitclass.</p>
<p><strong>arguments</strong>:</p>
<ul>
<li><dl class="first docutils">
<dt>spec:</dt>
<dd><p class="first last">Specifies the types of each field on this class.
Must be a dictionary or a sequence.
With a dictionary, use collections.OrderedDict for stable ordering.
With a sequence, it must contain 2-tuples of (fieldname, fieldtype).</p>
</dd>
</dl>
</li>
</ul>
<p><strong>returns</strong>:</p>
<p>A callable that takes a class object, which will be compiled.</p>
</dd></dl>

</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="../genindex.html" title="General Index" >index</a></li>
        <li><a href="../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="pycc.html" title="1.7. Compiling code ahead of time" >next</a></li>
        <li><a href="vectorize.html" title="1.5. Creating Numpy universal functions" >previous</a></li>
        <li><a href="../index.html">Numba 0.24.0+137.g4e7bc9c-py2.7-linux-x86_64.egg documentation</a></li>
        <li><a href="index.html" >1. User Manual</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2015, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>