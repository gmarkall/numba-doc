<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.9. Floating-point pitfalls &#8212; Numba 0.46.0.dev0+240.g2c92522-py2.7-linux-x86_64.egg documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/numba-docs.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.10. Python 2.7 End of Life Plan" href="python27-eol.html" />
    <link rel="prev" title="2.8. Deviations from Python Semantics" href="pysemantics.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/numba_blue_icon_rgb.png"></span>
          Numba</a>
        <span class="navbar-text navbar-version pull-left"><b>0.46</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">1. User Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/index.html">3. Numba for CUDA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roc/index.html">5. Numba for AMD ROC GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">2.9. Floating-point pitfalls</a><ul>
<li><a class="reference internal" href="#precision-and-accuracy">2.9.1. Precision and accuracy</a><ul>
<li><a class="reference internal" href="#math-library-implementations">2.9.1.1. Math library implementations</a></li>
<li><a class="reference internal" href="#linear-algebra">2.9.1.2. Linear algebra</a></li>
<li><a class="reference internal" href="#mixed-types-operations">2.9.1.3. Mixed-types operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#warnings-and-errors">2.9.2. Warnings and errors</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="pysemantics.html" title="Previous Chapter: 2.8. Deviations from Python Semantics"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 2.8. Deviations ...</span>
    </a>
  </li>
  <li>
    <a href="python27-eol.html" title="Next Chapter: 2.10. Python 2.7 End of Life Plan"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">2.10. Python 2.7... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/reference/fpsemantics.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="floating-point-pitfalls">
<h1>2.9. Floating-point pitfalls<a class="headerlink" href="#floating-point-pitfalls" title="Permalink to this headline">¶</a></h1>
<div class="section" id="precision-and-accuracy">
<h2>2.9.1. Precision and accuracy<a class="headerlink" href="#precision-and-accuracy" title="Permalink to this headline">¶</a></h2>
<p>For some operations, Numba may use a different algorithm than Python or
Numpy.  The results may not be bit-by-bit compatible.  The difference
should generally be small and within reasonable expectations.  However,
small accumulated differences might produce large differences at the end,
especially if a divergent function is involved.</p>
<div class="section" id="math-library-implementations">
<h3>2.9.1.1. Math library implementations<a class="headerlink" href="#math-library-implementations" title="Permalink to this headline">¶</a></h3>
<p>Numba supports a variety of platforms and operating systems, each of which
has its own math library implementation (referred to as <code class="docutils literal notranslate"><span class="pre">libm</span></code> from here
in).  The majority of math functions included in <code class="docutils literal notranslate"><span class="pre">libm</span></code> have specific
requirements as set out by the IEEE 754 standard (like <code class="docutils literal notranslate"><span class="pre">sin()</span></code>, <code class="docutils literal notranslate"><span class="pre">exp()</span></code>
etc.), but each implementation may have bugs.  Thus, on some platforms
Numba has to exercise special care in order to workaround known <code class="docutils literal notranslate"><span class="pre">libm</span></code>
issues.</p>
<p>Another typical problem is when an operating system’s <code class="docutils literal notranslate"><span class="pre">libm</span></code> function
set is incomplete and needs to be supplemented by additional functions.
These are provided with reference to the IEEE 754 and C99 standards
and are often implemented in Numba in a manner similar to equivalent
CPython functions.</p>
<p>In particular, math library issues are known to affect Python 2.7 builds
on Windows, since Python 2.7 requires the use of an obsolete version of
the Microsoft Visual Studio compiler.</p>
</div>
<div class="section" id="linear-algebra">
<h3>2.9.1.2. Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this headline">¶</a></h3>
<p>Numpy forces some linear algebra operations to run in double-precision mode
even when a <code class="docutils literal notranslate"><span class="pre">float32</span></code> input is given.  Numba will always observe
the input’s precision, and invoke single-precision linear algebra routines
when all inputs are <code class="docutils literal notranslate"><span class="pre">float32</span></code> or <code class="docutils literal notranslate"><span class="pre">complex64</span></code>.</p>
<p>The implementations of the <code class="docutils literal notranslate"><span class="pre">numpy.linalg</span></code> routines in Numba only support the
floating point types that are used in the LAPACK functions that provide
the underlying core functionality. As a result  only <code class="docutils literal notranslate"><span class="pre">float32</span></code>, <code class="docutils literal notranslate"><span class="pre">float64</span></code>,
<code class="docutils literal notranslate"><span class="pre">complex64</span></code> and <code class="docutils literal notranslate"><span class="pre">complex128</span></code> types are supported. If a user has e.g. an
<code class="docutils literal notranslate"><span class="pre">int32</span></code> type, an appropriate type conversion must be performed to a
floating point type prior to its use in these routines. The reason for this
decision is to essentially avoid having to replicate type conversion choices
made in Numpy and to also encourage the user to choose the optimal floating
point type for the operation they are undertaking.</p>
</div>
<div class="section" id="mixed-types-operations">
<h3>2.9.1.3. Mixed-types operations<a class="headerlink" href="#mixed-types-operations" title="Permalink to this headline">¶</a></h3>
<p>Numpy will most often return a <code class="docutils literal notranslate"><span class="pre">float64</span></code> as a result of a computation
with mixed integer and floating-point operands (a typical example is the
power operator <code class="docutils literal notranslate"><span class="pre">**</span></code>).  Numba by contrast will select the highest precision
amongst the floating-point operands, so for example <code class="docutils literal notranslate"><span class="pre">float32</span> <span class="pre">**</span> <span class="pre">int32</span></code>
will return a <code class="docutils literal notranslate"><span class="pre">float32</span></code>, regardless of the input values.  This makes
performance characteristics easier to predict, but you should explicitly
cast the input to <code class="docutils literal notranslate"><span class="pre">float64</span></code> if you need the extra precision.</p>
</div>
</div>
<div class="section" id="warnings-and-errors">
<span id="ufunc-fpu-errors"></span><h2>2.9.2. Warnings and errors<a class="headerlink" href="#warnings-and-errors" title="Permalink to this headline">¶</a></h2>
<p>When calling a <a class="reference internal" href="../glossary.html#term-ufunc"><span class="xref std std-term">ufunc</span></a> created with <a class="reference internal" href="jit-compilation.html#numba.vectorize" title="numba.vectorize"><code class="xref py py-func docutils literal notranslate"><span class="pre">vectorize()</span></code></a>,
Numpy will determine whether an error occurred by examining the FPU
error word.  It may then print out a warning or raise an exception
(such as <code class="docutils literal notranslate"><span class="pre">RuntimeWarning:</span> <span class="pre">divide</span> <span class="pre">by</span> <span class="pre">zero</span> <span class="pre">encountered</span></code>),
depending on the current error handling settings.</p>
<p>Depending on how LLVM optimized the ufunc’s code, however, some spurious
warnings or errors may appear.  If you get caught by this issue, we
recommend you call <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.seterr.html#numpy.seterr" title="(in NumPy v1.17)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.seterr()</span></code></a> to change Numpy’s error handling
settings, or the <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.errstate.html#numpy.errstate" title="(in NumPy v1.17)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.errstate</span></code></a> context manager to switch them
temporarily:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">my_ufunc</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012, Anaconda, Inc..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>