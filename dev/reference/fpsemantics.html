<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>2.9. Floating-point pitfalls &mdash; Numba 0.32.0.dev0+9.g3ee3107-py2.7-linux-x86_64.egg documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="../_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="../_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../',
            VERSION:     '0.32.0.dev0+9.g3ee3107-py2.7-linux-x86_64.egg',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="Numba 0.32.0.dev0+9.g3ee3107-py2.7-linux-x86_64.egg documentation" href="../index.html" />
    <link rel="up" title="2. Reference Manual" href="index.html" />
    <link rel="next" title="3. Numba for CUDA GPUs" href="../cuda/index.html" />
    <link rel="prev" title="2.8. Deviations from Python semantics" href="pysemantics.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Numba 0.32.0.dev0+9.g3ee3107-py2.7-linux-x86_64.egg documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="../genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="../py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="../cuda/index.html" title="3. Numba for CUDA GPUs" accesskey="N">next</a>
                </li>
                <li>
                <a href="pysemantics.html" title="2.8. Deviations from Python semantics" accesskey="P">previous</a>
                </li>
                <li>
                <a href="index.html" accesskey="U">2. Reference Manual</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.9. Floating-point pitfalls</a><ul>
<li><a class="reference internal" href="#precision-and-accuracy">2.9.1. Precision and accuracy</a><ul>
<li><a class="reference internal" href="#math-library-implementations">2.9.1.1. Math library implementations</a></li>
<li><a class="reference internal" href="#linear-algebra">2.9.1.2. Linear algebra</a></li>
<li><a class="reference internal" href="#mixed-types-operations">2.9.1.3. Mixed-types operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#warnings-and-errors">2.9.2. Warnings and errors</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pysemantics.html"
                        title="previous chapter">2.8. Deviations from Python semantics</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../cuda/index.html"
                        title="next chapter">3. Numba for CUDA GPUs</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/fpsemantics.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.9. Floating-point pitfalls</a><ul>
<li><a class="reference internal" href="#precision-and-accuracy">2.9.1. Precision and accuracy</a><ul>
<li><a class="reference internal" href="#math-library-implementations">2.9.1.1. Math library implementations</a></li>
<li><a class="reference internal" href="#linear-algebra">2.9.1.2. Linear algebra</a></li>
<li><a class="reference internal" href="#mixed-types-operations">2.9.1.3. Mixed-types operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#warnings-and-errors">2.9.2. Warnings and errors</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pysemantics.html"
                        title="previous chapter">2.8. Deviations from Python semantics</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../cuda/index.html"
                        title="next chapter">3. Numba for CUDA GPUs</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/fpsemantics.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="../search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="floating-point-pitfalls">
<h1>2.9. Floating-point pitfalls<a class="headerlink" href="#floating-point-pitfalls" title="Permalink to this headline">¶</a></h1>
<div class="section" id="precision-and-accuracy">
<h2>2.9.1. Precision and accuracy<a class="headerlink" href="#precision-and-accuracy" title="Permalink to this headline">¶</a></h2>
<p>For some operations, Numba may use a different algorithm than Python or
Numpy.  The results may not be bit-by-bit compatible.  The difference
should generally be small and within reasonable expectations.  However,
small accumulated differences might produce large differences at the end,
especially if a divergent function is involved.</p>
<div class="section" id="math-library-implementations">
<h3>2.9.1.1. Math library implementations<a class="headerlink" href="#math-library-implementations" title="Permalink to this headline">¶</a></h3>
<p>Numba supports a variety of platforms and operating systems, each of which
has its own math library implementation (referred to as <code class="docutils literal"><span class="pre">libm</span></code> from here
in).  The majority of math functions included in <code class="docutils literal"><span class="pre">libm</span></code> have specific
requirements as set out by the IEEE 754 standard (like <code class="docutils literal"><span class="pre">sin()</span></code>, <code class="docutils literal"><span class="pre">exp()</span></code>
etc.), but each implementation may have bugs.  Thus, on some platforms
Numba has to exercise special care in order to workaround known <code class="docutils literal"><span class="pre">libm</span></code>
issues.</p>
<p>Another typical problem is when an operating system&#8217;s <code class="docutils literal"><span class="pre">libm</span></code> function
set is incomplete and needs to be supplemented by additional functions.
These are provided with reference to the IEEE 754 and C99 standards
and are often implemented in Numba in a manner similar to equivalent
CPython functions.</p>
<p>In particular, math library issues are known to affect Python 2.7 builds
on Windows, since Python 2.7 requires the use of an obsolete version of
the Microsoft Visual Studio compiler.</p>
</div>
<div class="section" id="linear-algebra">
<h3>2.9.1.2. Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this headline">¶</a></h3>
<p>Numpy forces some linear algebra operations to run in double-precision mode
even when a <code class="docutils literal"><span class="pre">float32</span></code> input is given.  Numba will always observe
the input&#8217;s precision, and invoke single-precision linear algebra routines
when all inputs are <code class="docutils literal"><span class="pre">float32</span></code> or <code class="docutils literal"><span class="pre">complex64</span></code>.</p>
<p>The implementations of the <code class="docutils literal"><span class="pre">numpy.linalg</span></code> routines in Numba only support the
floating point types that are used in the LAPACK functions that provide
the underlying core functionality. As a result  only <code class="docutils literal"><span class="pre">float32</span></code>, <code class="docutils literal"><span class="pre">float64</span></code>,
<code class="docutils literal"><span class="pre">complex64</span></code> and <code class="docutils literal"><span class="pre">complex128</span></code> types are supported. If a user has e.g. an
<code class="docutils literal"><span class="pre">int32</span></code> type, an appropriate type conversion must be performed to a
floating point type prior to its use in these routines. The reason for this
decision is to essentially avoid having to replicate type conversion choices
made in Numpy and to also encourage the user to choose the optimal floating
point type for the operation they are undertaking.</p>
</div>
<div class="section" id="mixed-types-operations">
<h3>2.9.1.3. Mixed-types operations<a class="headerlink" href="#mixed-types-operations" title="Permalink to this headline">¶</a></h3>
<p>Numpy will most often return a <code class="docutils literal"><span class="pre">float64</span></code> as a result of a computation
with mixed integer and floating-point operands (a typical example is the
power operator <code class="docutils literal"><span class="pre">**</span></code>).  Numba by contrast will select the highest precision
amongst the floating-point operands, so for example <code class="docutils literal"><span class="pre">float32</span> <span class="pre">**</span> <span class="pre">int32</span></code>
will return a <code class="docutils literal"><span class="pre">float32</span></code>, regardless of the input values.  This makes
performance characteristics easier to predict, but you should explicitly
cast the input to <code class="docutils literal"><span class="pre">float64</span></code> if you need the extra precision.</p>
</div>
</div>
<div class="section" id="warnings-and-errors">
<span id="ufunc-fpu-errors"></span><h2>2.9.2. Warnings and errors<a class="headerlink" href="#warnings-and-errors" title="Permalink to this headline">¶</a></h2>
<p>When calling a <a class="reference internal" href="../glossary.html#term-ufunc"><span class="xref std std-term">ufunc</span></a> created with <a class="reference internal" href="jit-compilation.html#numba.vectorize" title="numba.vectorize"><code class="xref py py-func docutils literal"><span class="pre">vectorize()</span></code></a>,
Numpy will determine whether an error occurred by examining the FPU
error word.  It may then print out a warning or raise an exception
(such as <code class="docutils literal"><span class="pre">RuntimeWarning:</span> <span class="pre">divide</span> <span class="pre">by</span> <span class="pre">zero</span> <span class="pre">encountered</span></code>),
depending on the current error handling settings.</p>
<p>Depending on how LLVM optimized the ufunc&#8217;s code, however, some spurious
warnings or errors may appear.  If you get caught by this issue, we
recommend you call <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.seterr.html#numpy.seterr" title="(in NumPy v1.12)"><code class="xref py py-func docutils literal"><span class="pre">numpy.seterr()</span></code></a> to change Numpy&#8217;s error handling
settings, or the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.errstate.html#numpy.errstate" title="(in NumPy v1.12)"><code class="xref py py-class docutils literal"><span class="pre">numpy.errstate</span></code></a> context manager to switch them
temporarily:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">my_ufunc</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="../genindex.html" title="General Index" >index</a></li>
        <li><a href="../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../cuda/index.html" title="3. Numba for CUDA GPUs" >next</a></li>
        <li><a href="pysemantics.html" title="2.8. Deviations from Python semantics" >previous</a></li>
        <li><a href="../index.html">Numba 0.32.0.dev0+9.g3ee3107-py2.7-linux-x86_64.egg documentation</a></li>
        <li><a href="index.html" >2. Reference Manual</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2015, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>