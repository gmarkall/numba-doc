<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Arrays &mdash; numba 0.13.4-295-g29d80a7 documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    './',
            VERSION:     '0.13.4-295-g29d80a7',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="_static/js/jquery.min.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="numba 0.13.4-295-g29d80a7 documentation" href="index.html" />
    <link rel="next" title="UFuncs" href="ufuncs.html" />
    <link rel="prev" title="Types" href="types.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="index.html">numba 0.13.4-295-g29d80a7 documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="ufuncs.html" title="UFuncs" accesskey="N">next</a>
                </li>
                <li>
                <a href="types.html" title="Types" accesskey="P">previous</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Arrays</a><ul>
<li><a class="reference internal" href="#array-creation-loop-jitting">Array Creation &amp; Loop-Jitting</a></li>
<li><a class="reference internal" href="#loop-jitting-constraints">Loop Jitting Constraints</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="types.html"
                        title="previous chapter">Types</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ufuncs.html"
                        title="next chapter">UFuncs</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/arrays.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Arrays</a><ul>
<li><a class="reference internal" href="#array-creation-loop-jitting">Array Creation &amp; Loop-Jitting</a></li>
<li><a class="reference internal" href="#loop-jitting-constraints">Loop Jitting Constraints</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="types.html"
                        title="previous chapter">Types</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ufuncs.html"
                        title="next chapter">UFuncs</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/arrays.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="arrays">
<h1>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h1>
<p>Support for NumPy arrays is a key focus of Numba development and is currently
undergoing extensive refactorization and improvement. Most capabilities of NumPy
arrays are supported by Numba in object mode, and a few features are supported in
nopython mode too (with much more to come).</p>
<p>A few noteworthy limitations of arrays at this time:</p>
<ul class="simple">
<li>Arrays can be passed in to a function in nopython mode, but not returned.
Arrays can only be returned in object mode.</li>
<li>New arrays can only be created in object mode.</li>
<li>Currently there are no bounds checking for array indexing and slicing,
although negative indices will wrap around correctly.</li>
<li>NumPy array ufunc support in nopython node is incomplete at this time. Most
if not all ufuncs should work in object mode though.</li>
<li>Array slicing only works in object mode.</li>
</ul>
<div class="section" id="array-creation-loop-jitting">
<h2>Array Creation &amp; Loop-Jitting<a class="headerlink" href="#array-creation-loop-jitting" title="Permalink to this headline">¶</a></h2>
<p>NumPy array creation is not supported in nopython mode. Numba mitigates this by
automatically trying to jit loops in nopython mode. This allows for array
creation at the top of a function while still getting almost all the performance
of nopython mode. For example, the following simple function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># compiled in object mode</span>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sum</span>
</pre></div>
</div>
<p>looks like the equivalent of the following after being compiled by Numba:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># compiled in nopython mode</span>
<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">jitted_loop</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sum</span>

<span class="c"># compiled in object mode</span>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jitted_loop</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Another consequence of array creation being restricted to object mode is that
NumPy ufuncs that return the result as a new array are not allowed in nopython
mode. Fortunately we can declare an output array at the top of our function and
pass that in to the ufunc to store our result. For example, the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="c"># initialize stuff</span>

    <span class="c"># slow loop in object mode</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>should be rewritten like the following to take advantage of loop jitting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="c"># initialize stuff</span>

    <span class="c"># create output array</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="c"># jitted loop in nopython mode</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="loop-jitting-constraints">
<h2>Loop Jitting Constraints<a class="headerlink" href="#loop-jitting-constraints" title="Permalink to this headline">¶</a></h2>
<p>The current loop-jitting mechanism is very conservative.  A loop must satisfy
a set of constraints for loop-jitting to trigger. These constraints will be
relaxed in further development.</p>
<p>Currently, a loop is rejected if:</p>
<ul class="simple">
<li>the loop contains return statements;</li>
<li>the loop binds a value to a variable that is read outside of the loop.</li>
</ul>
<p>The following is rejected due to a return statement in the loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="c"># Rejected loop-jitting candidate</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>   <span class="c"># setitem is accepted</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span>      <span class="c"># return is not accepted</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The following is rejected due to an assigning to a variable read outside of
the loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c"># Rejected loop-jitting candidate</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>           <span class="c"># assign to variable &#39;x&#39;</span>

    <span class="n">result</span> <span class="o">+=</span> <span class="n">x</span>                 <span class="c"># reading variable &#39;x&#39;</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The following is accepted:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c"># Accepted loop-jitting candidate</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>               <span class="c"># &#39;x&#39; is only written to</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>The following is accepted:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c"># Accepted loop-jitting candidate</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>User can inspect the loop-jitting by running <cite>foo.inspect_types()</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre>foo (int32,) -&gt; pyobject
--------------------------------------------------------------------------------
# File: somefile.py
# --- LINE 1 ---

@jit

# --- LINE 2 ---

def foo(n):

    # --- LINE 3 ---
    # label 0
    #   $0.1 = global(numpy: &lt;module &#39;numpy&#39; from &#39;.../numpy/__init__.py&#39;&gt;)
      :: pyobject
    #   $0.2 = getattr(value=$0.1, attr=zeros)  :: pyobject
    #   result = call $0.2(n, )  :: pyobject

    result = numpy.zeros(n)

    # --- LINE 4 ---
    #   x = const(&lt;class &#39;int&#39;&gt;, 1)  :: pyobject

    x = 1

    # --- LINE 5 ---
    #   jump 58
    # label 58
    #   $58.1 = global(foo__numba__loop21__: LiftedLoop(&lt;function foo at 0x107781710&gt;))  :: pyobject
    #   $58.2 = call $58.1(n, result, x, )  :: pyobject
    #   jump 54

    for i in range(n):

        # --- LINE 6 ---

        result[i] = x

    # --- LINE 7 ---
    # label 54
    #   return result

    return result

# The function contains lifted loops
# Loop at line 5
# Has 1 overloads
# File: somefile.py
# --- LINE 1 ---

@jit

# --- LINE 2 ---

def foo(n):

    # --- LINE 3 ---

    result = numpy.zeros(n)

    # --- LINE 4 ---

    x = 1

    # --- LINE 5 ---
    # label 34
    #   $34.1 = iternext(value=$21.3)  :: int32
    #   $34.2 = itervalid(value=$21.3)  :: bool
    #   branch $34.2, 37, 53
    # label 21
    #   $21.1 = global(range: &lt;class &#39;range&#39;&gt;)  :: range
    #   $21.2 = call $21.1(n, )  :: (int32,) -&gt; range_state32
    #   $21.3 = getiter(value=$21.2)  :: range_iter32
    #   jump 34
    # label 37
    #   $37.1 = $34.1  :: int32
    #   i = $37.1  :: int32

    for i in range(n):

        # --- LINE 6 ---
        # label 53
        #   del $21.3
        #   jump 54
        # label 54
        #   $54.1 = const(&lt;class &#39;NoneType&#39;&gt;, None)  :: none
        #   return $54.1
        #   result[i] = x  :: (array(float64, 1d, C), int64, float64) -&gt; none
        #   jump 34

        result[i] = x

    # --- LINE 7 ---

    return result



================================================================================
</pre></div>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="genindex.html" title="General Index" >index</a></li>
        <li><a href="py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="ufuncs.html" title="UFuncs" >next</a></li>
        <li><a href="types.html" title="Types" >previous</a></li>
        <li><a href="index.html">numba 0.13.4-295-g29d80a7 documentation</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2014, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>