<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.3. Memory management &mdash; Numba 0.39.0.dev0+256.gdfb2b69-py2.7-linux-x86_64.egg documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.39.0.dev0+256.gdfb2b69-py2.7-linux-x86_64.egg',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Numba 0.39.0.dev0+256.gdfb2b69-py2.7-linux-x86_64.egg documentation" href="../index.html" />
    <link rel="up" title="5. Numba for HSA APUs" href="index.html" />
    <link rel="next" title="5.4. Writing Device Functions" href="device-functions.html" />
    <link rel="prev" title="5.2. Writing HSA Kernels" href="kernels.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/numba_blue_icon_rgb.png"></span>
          Numba</a>
        <span class="navbar-text navbar-version pull-left"><b>0.39</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">1. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">2. Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/index.html">3. Numba for CUDA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda-reference/index.html">4. CUDA Python Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">5. Numba for HSA APUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">6. Extending Numba</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">7. Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals/index.html">8. Numba Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">10. Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5.3. Memory management</a><ul>
<li><a class="reference internal" href="#shared-memory-and-thread-synchronization">5.3.1. Shared memory and thread synchronization</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="kernels.html" title="Previous Chapter: 5.2. Writing HSA Kernels"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 5.2. Writing HSA...</span>
    </a>
  </li>
  <li>
    <a href="device-functions.html" title="Next Chapter: 5.4. Writing Device Functions"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">5.4. Writing Dev... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/hsa/memory.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="memory-management">
<h1>5.3. Memory management<a class="headerlink" href="#memory-management" title="Permalink to this headline">¶</a></h1>
<p id="hsa-device-memory">The CPU and GPU in a APU share the same main memory.  There is no distinction
between CPU and GPU memory.  Even though a HSA kernel can directly consume any
data in the main memory, it is recommended to register a memory region to the
HSA runtime compatibility with HSA-compliant discrete GPUs.</p>
<dl class="function">
<dt id="hsa.register">
<code class="descclassname">hsa.</code><code class="descname">register</code><span class="sig-paren">(</span><em>*arrays</em><span class="sig-paren">)</span><a class="headerlink" href="#hsa.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register every given array.  The function can be used in a <em>with-context</em>
for automically deregistration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array_a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">array_b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">with</span> <span class="n">hsa</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">array_a</span><span class="p">,</span> <span class="n">array_b</span><span class="p">):</span>
    <span class="n">some_hsa_code</span><span class="p">(</span><span class="n">array_a</span><span class="p">,</span> <span class="n">array_b</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="hsa.deregister">
<code class="descclassname">hsa.</code><code class="descname">deregister</code><span class="sig-paren">(</span><em>*arrays</em><span class="sig-paren">)</span><a class="headerlink" href="#hsa.deregister" title="Permalink to this definition">¶</a></dt>
<dd><p>Deregister every given array</p>
</dd></dl>

<div class="section" id="shared-memory-and-thread-synchronization">
<span id="hsa-shared-memory"></span><h2>5.3.1. Shared memory and thread synchronization<a class="headerlink" href="#shared-memory-and-thread-synchronization" title="Permalink to this headline">¶</a></h2>
<p>A limited amount of shared memory can be allocated on the device to speed
up access to data, when necessary.  That memory will be shared (i.e. both
readable and writable) amongst all workitems  belonging to a given group
and has faster access times than regular device memory.  It also allows
workitems to cooperate on a given solution.  You can think of it as a
manually-managed data cache.</p>
<p>The memory is allocated once for the duration of the kernel, unlike
traditional dynamic memory management.</p>
<dl class="function">
<dt id="numba.hsa.shared.array">
<code class="descclassname">numba.hsa.shared.</code><code class="descname">array</code><span class="sig-paren">(</span><em>shape</em>, <em>type</em><span class="sig-paren">)</span><a class="headerlink" href="#numba.hsa.shared.array" title="Permalink to this definition">¶</a></dt>
<dd><p>Allocate a shared array of the given <em>shape</em> and <em>type</em> on the device.
This function must be called on the device (i.e. from a kernel or
device function).  <em>shape</em> is either an integer or a tuple of integers
representing the array&#8217;s dimensions.  <em>type</em> is a <a class="reference internal" href="../reference/types.html#numba-types"><span>Numba type</span></a>
of the elements needing to be stored in the array.</p>
<p>The returned array-like object can be read and written to like any normal
device array (e.g. through indexing).</p>
<p>A common pattern is to have each workitem populate one element in the
shared array and then wait for all workitems to finish using :func:`
.barrier`.</p>
</dd></dl>

<dl class="function">
<dt id="numba.hsa.barrier">
<code class="descclassname">numba.hsa.</code><code class="descname">barrier</code><span class="sig-paren">(</span><em>scope</em><span class="sig-paren">)</span><a class="headerlink" href="#numba.hsa.barrier" title="Permalink to this definition">¶</a></dt>
<dd><p>The <code class="docutils literal"><span class="pre">scope</span></code> argument specifies the level of synchronization.  Set <code class="docutils literal"><span class="pre">scope</span></code>
to <code class="docutils literal"><span class="pre">1</span></code> to synchronize all workitems in the same workgroup.</p>
</dd></dl>

<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="examples.html#hsa-matmul"><span>Matrix multiplication example</span></a>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012, Anaconda, Inc..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>