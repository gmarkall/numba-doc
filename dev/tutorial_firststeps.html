<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>First Steps with numba &mdash; numba 0.16.0_198_gcb9d486-py2.7-linux-x86_64.egg documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    './',
            VERSION:     '0.16.0_198_gcb9d486-py2.7-linux-x86_64.egg',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="_static/js/jquery.min.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="numba 0.16.0_198_gcb9d486-py2.7-linux-x86_64.egg documentation" href="index.html" />
    <link rel="next" title="Numba and types" href="tutorial_types.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="index.html">numba 0.16.0_198_gcb9d486-py2.7-linux-x86_64.egg documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="tutorial_types.html" title="Numba and types" accesskey="N">next</a>
                </li>
                <li>
                <a href="examples.html" title="Examples" accesskey="P">previous</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">First Steps with numba</a><ul>
<li><a class="reference internal" href="#introduction-to-numba">Introduction to numba</a></li>
<li><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li><a class="reference internal" href="#compiling-a-function-with-numba-jit-using-an-explicit-function-signature">Compiling a function with numba.jit using an explicit function signature</a></li>
<li><a class="reference internal" href="#signature">Signature</a></li>
<li><a class="reference internal" href="#compiling-a-function-without-providing-a-function-signature-autojit-functionality">Compiling a function without providing a function signature (autojit functionality)</a></li>
<li><a class="reference internal" href="#some-extra-remarks">Some extra remarks</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.html"
                        title="previous chapter">Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial_types.html"
                        title="next chapter">Numba and types</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial_firststeps.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">First Steps with numba</a><ul>
<li><a class="reference internal" href="#introduction-to-numba">Introduction to numba</a></li>
<li><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li><a class="reference internal" href="#compiling-a-function-with-numba-jit-using-an-explicit-function-signature">Compiling a function with numba.jit using an explicit function signature</a></li>
<li><a class="reference internal" href="#signature">Signature</a></li>
<li><a class="reference internal" href="#compiling-a-function-without-providing-a-function-signature-autojit-functionality">Compiling a function without providing a function signature (autojit functionality)</a></li>
<li><a class="reference internal" href="#some-extra-remarks">Some extra remarks</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.html"
                        title="previous chapter">Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial_types.html"
                        title="next chapter">Numba and types</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial_firststeps.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="first-steps-with-numba">
<h1>First Steps with numba<a class="headerlink" href="#first-steps-with-numba" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numba</span>
<span class="k">print</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>0.12.0
</pre></div>
</div>
<div class="section" id="introduction-to-numba">
<h2>Introduction to numba<a class="headerlink" href="#introduction-to-numba" title="Permalink to this headline">¶</a></h2>
<p>Numba allows the compilation of selected portions of Python code to
native code, using llvm as its backend. This allows the selected
functions to execute at a speed competitive with code generated by C
compilers.</p>
<p>It works at the function level. We can take a function, generate native
code for that function as well as the wrapper code needed to call it
directly from Python. This compilation is done on-the-fly and in-memory.</p>
<p>In this notebook I will illustrate some very simple usage of numba.</p>
</div>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s start with a simple, yet time consuming function: a Python
implementation of bubblesort. This bubblesort implementation works on a
NumPy array.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">bubblesort</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cur</span> <span class="o">&gt;</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</pre></div>
</div>
<p>Now, let&#8217;s try the function, this way we check that it works. First
we&#8217;ll create an array of sorted values and randomly shuffle them:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;f4&#39;</span><span class="p">)</span>
<span class="n">shuffled</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shuffled</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we&#8217;ll create a copy and do our bubble sort on the copy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">sorted</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">bubblesort</span><span class="p">(</span><span class="nb">sorted</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="nb">sorted</span><span class="p">,</span> <span class="n">original</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<p>Let&#8217;s see how it behaves in execution time:</p>
<div class="code python highlight-python"><div class="highlight"><pre>sorted[:] = shuffled[:]
%timeit sorted[:] = shuffled[:]; bubblesort(sorted)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1 loops, best of 3: 328 ms per loop
</pre></div>
</div>
<p>Note that as execution time may depend on its input and the function
itself is destructive, I make sure to use the same input in all the
timings, by copying the original shuffled array into the new one.
%timeit makes several runs and takes the best result, if the copy wasn&#8217;t
done inside the timing code the vector would only be unsorted in the
first iteration. As bubblesort works better on vectors that are already
sorted, the next runs would be selected and we will get the time when
running bubblesort in an already sorted array. In our case the copy time
is minimal, though:</p>
<div class="code python highlight-python"><div class="highlight"><pre>%timeit sorted[:] = shuffled[:]
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1000000 loops, best of 3: 1.17 µs per loop
</pre></div>
</div>
</div>
<div class="section" id="compiling-a-function-with-numba-jit-using-an-explicit-function-signature">
<h2>Compiling a function with numba.jit using an explicit function signature<a class="headerlink" href="#compiling-a-function-with-numba-jit-using-an-explicit-function-signature" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s get a numba version of this code running. One way to compile a
function is by using the <em>numba.jit</em> decorator with an explicit
signature. Later, we will see that we can get by without providing such
a <em>signature</em> by letting <em>numba</em> figure out the <em>signatures</em> by itself.
However, it is useful to know what the signature is, and what role it
has in <em>numba</em>.</p>
<p>First, let&#8217;s start by peeking at the numba.jit string-doc:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>jit([signature_or_function, [locals={}, [target=&#39;cpu&#39;,
            [**targetoptions]]]])

    The function can be used as the following versions:

    1) jit(signature, [target=&#39;cpu&#39;, [**targetoptions]]) -&gt; jit(function)

        Equivalent to:

            d = dispatcher(function, targetoptions)
            d.compile(signature)

        Create a dispatcher object for a python function and default
        target-options.  Then, compile the funciton with the given signature.

        Example:

            @jit(&quot;void(int32, float32)&quot;)
            def foo(x, y):
                return x + y

    2) jit(function) -&gt; dispatcher

        Same as old autojit.  Create a dispatcher function object that
        specialize at call site.

        Example:

            @jit
            def foo(x, y):
                return x + y

    3) jit([target=&#39;cpu&#39;, [**targetoptions]]) -&gt; configured_jit(function)

        Same as old autojit and 2).  But configure with target and default
        target-options.


        Example:

            @jit(target=&#39;cpu&#39;, nopython=True)
            def foo(x, y):
                return x + y

    Target Options
    ---------------
    The CPU (default target) defines the following:

        - nopython: [bool]

            Set to True to disable the use of PyObjects and Python API
            calls.  The default behavior is to allow the use of PyObjects and
            Python API.  Default value is False.

        - forceobj: [bool]

            Set to True to force the use of PyObjects for every value.  Default
            value is False.
</pre></div>
</div>
<p>So let&#8217;s make a compiled version of our bubblesort:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">bubblesort_jit</span> <span class="o">=</span> <span class="n">numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s">&quot;void(f4[:])&quot;</span><span class="p">)(</span><span class="n">bubblesort</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, <strong>bubblesort_jit</strong> contains the compiled function
-wrapped so that is directly callable from Python- generated from the
original bubblesort function. Note that there is a fancy parameter
<em>&#8220;void(f4[:])&#8221;</em> that is passed. That parameter describes the <em>signature</em>
of the function to generate (more on this later).</p>
<p>Let&#8217;s check that it works:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">sorted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">shuffled</span><span class="p">[:]</span> <span class="c"># reset to shuffled before sorting</span>
<span class="n">bubblesort_jit</span><span class="p">(</span><span class="nb">sorted</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="nb">sorted</span><span class="p">,</span> <span class="n">original</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<p>Now let&#8217;s compare the time it takes to execute the compiled function
compared to the original</p>
<div class="code python highlight-python"><div class="highlight"><pre>%timeit sorted[:] = shuffled[:]; bubblesort_jit(sorted)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1000 loops, best of 3: 1.25 ms per loop
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>%timeit sorted[:] = shuffled[:]; bubblesort(sorted)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1 loops, best of 3: 323 ms per loop
</pre></div>
</div>
<p>Bear in mind that numba.jit is a decorator, although for practical
reasons in this tutorial we will be calling it like a function to have
access to both, the original function and the jitted one. In many
practical uses, the decorator syntax may be more appropriate. With the
decorator syntax our sample will look like this:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@numba.jit</span><span class="p">(</span><span class="s">&quot;void(f4[:])&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bubblesort_jit</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cur</span> <span class="o">&gt;</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</pre></div>
</div>
</div>
<div class="section" id="signature">
<h2>Signature<a class="headerlink" href="#signature" title="Permalink to this headline">¶</a></h2>
<p>In order to generate fast code, the compiler needs type information for
the code. This allows a direct mapping from the Python operations to the
appropriate machine instruction without any type check/dispatch
mechanism. In numba, in most cases it suffices to specify the types for
the parameters. In many cases, numba can deduce types for intermediate
values as well as the return value using <em>type inference</em>. For
convenience, it is also possible to specify in the signature the type of
the <em>return value</em></p>
<p>A <em>numba.jit</em> compiled function will only work when called with the
right type of arguments (it may, however, perform some conversions on
types that it considers equivalent).</p>
<p>A <em>signature</em> contains the return type as well as the argument types.
One way to specify the signature is using a string, like in our example.
The <em>signature</em> takes the form:
<tt class="docutils literal"><span class="pre">&lt;return</span> <span class="pre">type&gt;</span> <span class="pre">(</span> <span class="pre">&lt;arg1</span> <span class="pre">type&gt;,</span> <span class="pre">&lt;arg2</span> <span class="pre">type&gt;,</span> <span class="pre">...</span> <span class="pre">)</span></tt>. The types may be
scalars or arrays (NumPy arrays). In our example, <tt class="docutils literal"><span class="pre">void(f4[:])</span></tt>, it
means a function with no return (return type is <tt class="docutils literal"><span class="pre">void</span></tt>) that takes as
unique argument an one-dimensional array of 4 byte floats <tt class="docutils literal"><span class="pre">f4[:]</span></tt>.
Starting with numba version 0.12 the result type is optional. In that
case the signature will look like the following:
<tt class="docutils literal"><span class="pre">&lt;arg1</span> <span class="pre">type&gt;,</span> <span class="pre">&lt;arg2</span> <span class="pre">type&gt;,</span> <span class="pre">...</span></tt>. When the signature doesn&#8217;t provide a
type for the return value, the type is <em>inferred</em>.</p>
<p>One way to specify the signature is by using such a string, the type for
each argument being based on NumPy dtype strings for base types. Array
types are also supported by using [:] type notation, where [:] is a
one-dimensional strided array, [::1] is a one-dimensional contiguous
array, [:,:] a bidimensional strided array, [:,:,:] a tridimiensional
array, and so on. There are other ways to build the signature, you can
find more details on signatures in its documentation page.</p>
<p>Some sample signatures follow:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">signature</th>
<th class="head">meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">void(f4[:],</span> <span class="pre">u8)</span></tt></td>
<td>a function with no return value taking a one-dimensional array of single precision floats and a 64-bit unsigned integer.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">i4(f8)</span></tt></td>
<td>a function returning a 32-bit signed integer taking a double precision float as argument.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">void(f4[:,:],f4[:,:])</span></tt></td>
<td>a function with no return value taking two 2-dimensional arrays as arguments.</td>
</tr>
</tbody>
</table>
<p>For a more in-depth explanation on supported types you can take a look
at the &#8220;Numba types&#8221; notebook tutorial.</p>
</div>
<div class="section" id="compiling-a-function-without-providing-a-function-signature-autojit-functionality">
<h2>Compiling a function without providing a function signature (autojit functionality)<a class="headerlink" href="#compiling-a-function-without-providing-a-function-signature-autojit-functionality" title="Permalink to this headline">¶</a></h2>
<p>Starting with numba version 0.12, it is possible to use <em>numba.jit</em>
without providing a type-signature for the function. This functionality
was provided by <em>numba.autojit</em> in previous versions of <em>numba</em>. The old
<em>numba.autojit</em> hass been deprecated in favour of this signature-less
version of <em>numba.jit</em>.</p>
<p>When no <em>type-signature</em> is provided, the decorator returns wrapper code
that will automatically create and run a <em>numba</em> compiled version when
called. When called, resulting function will infer the types of the
arguments being used. That information will be used to generated the
<em>signature</em> to be used when compiling. The resulting compiled function
will be called with the provided arguments.</p>
<p>For performance reasons, functions are cached so that code is only
compiled once for a given signature. It is possible to call the function
with different signatures, in that case, different native code will be
generated and the right version will be chosen based on the argument
types.</p>
<p>For most uses, using jit without a signature will be the simplest
option.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">bubblesort_autojit</span> <span class="o">=</span> <span class="n">numba</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">bubblesort</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>%timeit sorted[:] = shuffled[:]; bubblesort_autojit(sorted)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1000 loops, best of 3: 1.25 ms per loop
</pre></div>
</div>
</div>
<div class="section" id="some-extra-remarks">
<h2>Some extra remarks<a class="headerlink" href="#some-extra-remarks" title="Permalink to this headline">¶</a></h2>
<p>There is no magic, there are several details that is good to know about
numba.</p>
<p>First, compiling takes time. Luckily enough it will not be a lot of
time, specially for small functions. But when compiling many functions
with many specializations the time may add up. Numba tries to do its
best by caching compilation as much as possible though, so no time is
spent in spurious compilation. It does its best to be <em>lazy</em> regarding
compilation, this allows not paying the compilation time for code that
is not used.</p>
<p>Second, not all code is compiled equal. There will be code that <em>numba</em>
compiles down to an efficient native function. Sometimes the code
generated has to fallback to the Python object system and its dispatch
semantics. Other code may not compile at all.</p>
<p>When targeting the &#8220;cpu&#8221; target (the default), <em>numba</em> will either
generate:</p>
<ul class="simple">
<li>Fast native code -also called <a class="reference internal" href="glossary.html#term-nopython-mode"><em class="xref std std-term">nopython mode</em></a>-. The compiler was able to
infer all the types in the function, so it can translate the code to
a fast native routine without making use of the Python runtime.</li>
<li>Native code with calls to the Python run-time -also called <a class="reference internal" href="glossary.html#term-object-mode"><em class="xref std std-term">object mode</em></a>-.
The compiler was not able to infer all the types, so that at
some point a value was typed as a generic &#8216;object&#8217;. This means the
full native version can&#8217;t be used. Instead, numba generates code
using the Python run-time that should be faster than actual
interpretation but quite far from what you could expect from a full
native function.</li>
</ul>
<p>By default, the &#8216;cpu&#8217; target tries to compile the function in &#8216;nopython&#8217;
mode. If this fails, it tries again in object mode.</p>
<p>This example shows how falling back to Python objects may cause a
slowdown in the generated code:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@numba.jit</span><span class="p">(</span><span class="s">&quot;void(i1[:])&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
        <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span>

<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="nd">@numba.jit</span><span class="p">(</span><span class="s">&quot;void(i1[:])&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test2</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
        <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;i1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>%timeit test(res)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>10000 loops, best of 3: 31.9 µs per loop
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>%timeit test2(res)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1 loops, best of 3: 283 ms per loop
</pre></div>
</div>
<p>It is possible to force a failure if the <em>nopython</em> code generation
fails. This allows getting some feedback about whether it is possible to
generate code for a given function that doesn&#8217;t rely on the Python
run-time. This can help when trying to write fast code, as object mode
can have a huge performance penalty.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@numba.jit</span><span class="p">(</span><span class="s">&quot;void(i1[:])&quot;</span><span class="p">,</span> <span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
        <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span>
</pre></div>
</div>
<p>On the other hand, <em>test2</em> fails if we pass the <em>nopython</em> keyword:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@numba.jit</span><span class="p">(</span><span class="s">&quot;void(i1[:])&quot;</span><span class="p">,</span> <span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test2</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
        <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------
TypingError                               Traceback (most recent call last)

&lt;ipython-input-19-6038b783c49c&gt; in &lt;module&gt;()
----&gt; 1 @numba.jit(&quot;void(i1[:])&quot;, nopython=True)
      2 def test2(value):
      3     for i in xrange(len(value)):
      4         value[i] = i % Decimal(100)


/Users/jayvius/Projects/numba/numba/decorators.pyc in wrapper(func)
    125         disp = dispatcher(py_func=func,  locals=locals,
    126                           targetoptions=targetoptions)
--&gt; 127         disp.compile(sig)
    128         disp.disable_compile()
    129         return disp


/Users/jayvius/Projects/numba/numba/dispatcher.pyc in compile(self, sig, locals, **targetoptions)
    107             cres = compiler.compile_extra(typingctx, targetctx, self.py_func,
    108                                           args=args, return_type=return_type,
--&gt; 109                                           flags=flags, locals=locs)
    110
    111             # Check typing error if object mode is used


/Users/jayvius/Projects/numba/numba/compiler.pyc in compile_extra(typingctx, targetctx, func, args, return_type, flags, locals)
     77                                                                    args,
     78                                                                    return_type,
---&gt; 79                                                                    locals)
     80         except Exception as e:
     81             if not flags.enable_pyobject:


/Users/jayvius/Projects/numba/numba/compiler.pyc in type_inference_stage(typingctx, interp, args, return_type, locals)
    156         infer.seed_type(k, v)
    157
--&gt; 158     infer.build_constrain()
    159     infer.propagate()
    160     typemap, restype, calltypes = infer.unify()


/Users/jayvius/Projects/numba/numba/typeinfer.pyc in build_constrain(self)
    271         for blk in utils.dict_itervalues(self.blocks):
    272             for inst in blk.body:
--&gt; 273                 self.constrain_statement(inst)
    274
    275     def propagate(self):


/Users/jayvius/Projects/numba/numba/typeinfer.pyc in constrain_statement(self, inst)
    368     def constrain_statement(self, inst):
    369         if isinstance(inst, ir.Assign):
--&gt; 370             self.typeof_assign(inst)
    371         elif isinstance(inst, ir.SetItem):
    372             self.typeof_setitem(inst)


/Users/jayvius/Projects/numba/numba/typeinfer.pyc in typeof_assign(self, inst)
    390                                              src=value.name, loc=inst.loc))
    391         elif isinstance(value, ir.Global):
--&gt; 392             self.typeof_global(inst, inst.target, value)
    393         elif isinstance(value, ir.Expr):
    394             self.typeof_expr(inst, inst.target, value)


/Users/jayvius/Projects/numba/numba/typeinfer.pyc in typeof_global(self, inst, target, gvar)
    470             except KeyError:
    471                 raise TypingError(&quot;Untyped global name &#39;%s&#39;&quot; % gvar.name,
--&gt; 472                                   loc=inst.loc)
    473             self.assumed_immutables.add(inst)
    474             self.typevars[target.name].lock(gvty)


TypingError: Untyped global name &#39;Decimal&#39;
File &quot;&lt;ipython-input-19-6038b783c49c&gt;&quot;, line 4
</pre></div>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="genindex.html" title="General Index" >index</a></li>
        <li><a href="py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="tutorial_types.html" title="Numba and types" >next</a></li>
        <li><a href="examples.html" title="Examples" >previous</a></li>
        <li><a href="index.html">numba 0.16.0_198_gcb9d486-py2.7-linux-x86_64.egg documentation</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2014, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>