<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>UFuncs &mdash; numba 0.13.4 documentation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
<link rel="stylesheet" href="_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" href="_static/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="_static/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="_static/css/font-awesome-ie7.min.css">
<![endif]-->
<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
}
</style>
<link rel="stylesheet" href="_static/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="_static/css/bootstrap-responsive.min.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    './',
            VERSION:     '0.13.4',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="_static/js/jquery.min.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    $('.show-sidebar').click(function(e) {
       e.preventDefault();
       if ($(".show-sidebar").html() == "Open Table Of Contents") {
          $('.for-mobile').removeClass('hidden-phone');
          $(".show-sidebar").html("Close Table Of Contents");
       } else {
          $(".show-sidebar").html("Open Table Of Contents");
       }
    });
  });
</script>
    <link rel="top" title="numba 0.13.4 documentation" href="index.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Arrays" href="arrays.html" /> 
  </head>
  <body>
    <div class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="index.html">numba 0.13.4 documentation</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right">
              
                <li>
                <a href="genindex.html" title="General Index" accesskey="I">index</a>
                </li>
                <li>
                <a href="py-modindex.html" title="Python Module Index" >modules</a>
                </li>
                <li>
                <a href="examples.html" title="Examples" accesskey="N">next</a>
                </li>
                <li>
                <a href="arrays.html" title="Arrays" accesskey="P">previous</a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">


      
      <div class="row-fluid hidden-desktop hidden-tablet">
      
<div class="span3 ">
  <a class="visible-phone btn btn-small show-sidebar" data-toggle="collapse" data-target=".for-mobile">Open Table Of Contents</a>
  <div class="for-mobile sidebar hidden-phone">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">UFuncs</a><ul>
<li><a class="reference internal" href="#id1">Ufuncs</a></li>
<li><a class="reference internal" href="#generalized-ufuncs">Generalized Ufuncs</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="arrays.html"
                        title="previous chapter">Arrays</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.html"
                        title="next chapter">Examples</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ufuncs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div>
      </div>
      

      <!-- row -->
      <div class="row-fluid">
         
<div class="span3 visible-desktop visible-tablet">
  <div class=" sidebar hidden-phone">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">UFuncs</a><ul>
<li><a class="reference internal" href="#id1">Ufuncs</a></li>
<li><a class="reference internal" href="#generalized-ufuncs">Generalized Ufuncs</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="arrays.html"
                        title="previous chapter">Arrays</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.html"
                        title="next chapter">Examples</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ufuncs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox">
  <h3>Quick search</h3>
  <form class="search form-search" action="search.html" method="get">
      <div class="input-append">
        <input type="text" class="search-query" name="q">
        <input type="submit" class="btn" value="Go" />
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="span9">
          <div class="document">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="ufuncs">
<h1>UFuncs<a class="headerlink" href="#ufuncs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>Ufuncs<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Numba&#8217;s vectorize allows Numba functions taking scalar input arguments to be used as
NumPy ufuncs (see <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/ufuncs.html">http://docs.scipy.org/doc/numpy/reference/ufuncs.html</a>).
Creating a traditional NumPy ufunc is not the most difficult task in the world,
but it is also not the most straightforward process and involves writing some
C code. Numba makes this easy though. Using the vectorize decorator,
Numba can compile a Python function into a ufunc that operates over NumPy
arrays as fast as traditional ufuncs written in C.</p>
<p>Ufunc arguments are scalars of a NumPy array. Function definitions can be arbitrary
mathematical expressions. The vectorize decorator needs to know the argument
and return types of the ufunc. These are specified much like the jit decorator:</p>
<div class="highlight-python"><pre>import math

@vectorize(['float64(float64, float64)'])
def my_ufunc(x, y):
    return x+y+math.sqrt(x*math.cos(y))

a = np.arange(1.0, 10.0)
b = np.arange(1.0, 10.0)
# Calls compiled version of my_ufunc for each element of a and b
print(my_ufunc(a, b))</pre>
</div>
<p>Multiple signatures can be specified to handle multiple input types:</p>
<div class="highlight-python"><pre>@vectorize(['int32(int32, int32)',
            'float64(float64, float64)'])
def my_ufunc(x, y):
    return x+y+math.sqrt(x*math.cos(y))

a = np.arange(1.0, 10.0, dtype='f8')
b = np.arange(1.0, 10.0, dtype='f8')
print(my_ufunc(a, b))

a = np.arange(1, 10, dtype='i4')
b = np.arange(1, 10, dtype='i4')
print(my_ufunc(a, b))</pre>
</div>
<p>The order of the signatures is important. Numba dispatches based on the input
array types and uses the first ufunc signature that the input types can be
safely cast to. In the example above, if the float64 signature had been listed
first, the call to sum with int32 arrays would have produced a float64 array
as the result.</p>
<p>An alternative syntax is to use the UFuncBuilder object to build a list of
function signatures:</p>
<div class="highlight-python"><pre>from numba.npyufunc.ufuncbuilder import UFuncBuilder

def my_ufunc(x, y):
    return x+y+math.sqrt(x*math.cos(y))

builder = UFuncBuilder(my_ufunc)
builder.add(restype=i4, argtypes=[i4, i4])
builder.add(restype=f8, argtypes=[f8, f8])</pre>
</div>
<p>To compile our ufunc we call the build_ufunc method:</p>
<div class="highlight-python"><pre>compiled_ufunc = builder.build_ufunc()

a = np.arange(1.0, 10.0, dtype='f8')
b = np.arange(1.0, 10.0, dtype='f8')
print(compiled_ufunc(a, b))</pre>
</div>
<p>Since we defined a binary ufunc, we can use the various NumPy ufunc methods
such as <tt class="docutils literal"><span class="pre">reduce</span></tt>, <tt class="docutils literal"><span class="pre">accumulate</span></tt>, etc:</p>
<div class="highlight-python"><pre>a = np.arange(100)
print(compiled_ufunc.reduce(a))
print(compiled_ufunc.accumulate(a))</pre>
</div>
</div>
<div class="section" id="generalized-ufuncs">
<h2>Generalized Ufuncs<a class="headerlink" href="#generalized-ufuncs" title="Permalink to this headline">¶</a></h2>
<p>Numba also provides support for generalized ufuncs with the guvectorize decorator.
Traditional ufuncs perfom element-wise operations, whereas generalized ufuncs
operate on entire sub-arrays. In addition to the argument and return types,
the guvectorize decorator takes an additional signature which specifies the
shapes of the inner arrays we want to operate on:</p>
<div class="highlight-python"><pre>import math

@guvectorize(['void(int32[:,:], int32[:,:], int32[:,:])',
              'void(float64[:,:], float64[:,:], float64[:,:])'],
              '(x, y),(x, y)-&gt;(x, y)')
def my_gufunc(a, b, c):
    for i in range(c.shape[0]):
        for j in range(c.shape[1]):
            c[i, j] = a[i, j] + b[i, j]

a = np.arange(1.0, 10.0, dtype='f8').reshape(3,3)
b = np.arange(1.0, 10.0, dtype='f8').reshape(3,3)
# Calls compiled version of my_gufunc for each row of a and b
print(my_gufunc(a, b))</pre>
</div>
<p>Notice that we don&#8217;t have a third argument in the gufunc call but the generalized
ufunc definition above has three arguments. The last argument of the generalized
ufunc is the output, which is automatically allocated with the shape specified
in the signature.</p>
<p>Generalized ufuncs also have an alternative syntax. We can use the GUFuncBuilder
object to build a list of function signatures and specify the shape of the arguments:</p>
<div class="highlight-python"><pre>from numba.npyufunc.ufuncbuilder import GUFuncBuilder

def my_gufunc(a, b, c):
    for i in range(c.shape[0]):
        for j in range(c.shape[1]):
            c[i, j] = a[i, j] + b[i, j]

builder = GUFuncBuilder(my_ufunc, '(x, y),(x, y)-&gt;(x, y)')
builder.add('void(int32[:,:], int32[:,:], int32[:,:])')
builder.add('void(float64[:,:], float64[:,:], float64[:,:])')</pre>
</div>
<p>To compile our ufunc we call the build_ufunc method:</p>
<div class="highlight-python"><pre>compiled_gufunc = builder.build_ufunc()

a = np.arange(1.0, 10.0, dtype='f8').reshape(3,3)
b = np.arange(1.0, 10.0, dtype='f8').reshape(3,3)
print(my_gufunc(a, b))</pre>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row-fluid">
<div class="related navbar ">
  <div class="navbar-inner">
    <ul class="nav pull-right">
      
        <li><a href="genindex.html" title="General Index" >index</a></li>
        <li><a href="py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="examples.html" title="Examples" >next</a></li>
        <li><a href="arrays.html" title="Arrays" >previous</a></li>
        <li><a href="index.html">numba 0.13.4 documentation</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer>
          &copy; Copyright 2012-2014, Continuum Analytics.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>